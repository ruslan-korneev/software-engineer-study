# DNS — система доменных имён

**DNS (Domain Name System)** — это "телефонная книга" интернета. Преобразует доменные имена в IP-адреса.

```
google.com  →  DNS  →  142.250.74.46
```

Браузер не знает, куда идти по имени `google.com`. DNS подсказывает IP.

## Как работает DNS-запрос?

```
1. Ты вводишь: google.com
              ↓
2. Браузер → Кэш браузера (есть?)
              ↓ нет
3. ОС → Кэш системы (есть?)
              ↓ нет
4. ОС → DNS-резолвер провайдера
              ↓
5. Резолвер → Root DNS ("где .com?")
              ↓
6. Резолвер → TLD DNS .com ("где google.com?")
              ↓
7. Резолвер → Authoritative DNS google.com
              ↓
8. Ответ: 142.250.74.46
              ↓
9. Кэшируется на каждом уровне
```

## Иерархия DNS

```
                    . (root)
                   /    \
               .com    .ru    .org ...
              /          \
         google.com    yandex.ru
            /              \
      mail.google.com   music.yandex.ru
```

**Root-серверы** — 13 групп серверов по всему миру:
- a.root-servers.net ... m.root-servers.net
- Физически это сотни серверов (anycast)

## Участники DNS-запроса

| Роль | Описание |
|------|----------|
| **Stub resolver** | Клиент (браузер, ОС) — делает запрос |
| **Recursive resolver** | Резолвер провайдера — ищет ответ рекурсивно |
| **Root server** | Знает, где TLD-серверы |
| **TLD server** | Знает, где authoritative-серверы для доменов в зоне |
| **Authoritative server** | Хранит реальные записи домена |

## Типы DNS-записей

| Тип | Назначение | Пример |
|-----|------------|--------|
| **A** | Домен → IPv4 | `example.com → 93.184.216.34` |
| **AAAA** | Домен → IPv6 | `example.com → 2606:2800:220:1::` |
| **CNAME** | Алиас на другой домен | `www → example.com` |
| **MX** | Почтовый сервер (+ приоритет) | `10 mail.example.com` |
| **TXT** | Текстовая информация | SPF, DKIM, верификация домена |
| **NS** | DNS-серверы домена | `ns1.provider.com` |
| **SOA** | Start of Authority — метаданные зоны | Серийный номер, TTL по умолчанию |
| **PTR** | Обратный запрос: IP → домен | Для проверки почтовых серверов |
| **SRV** | Сервис: порт + хост | `_sip._tcp.example.com` |

## Пример DNS-записей для сайта

```dns
; A-записи — основной сайт
example.com.        A       93.184.216.34
www.example.com.    CNAME   example.com.

; API на другом сервере
api.example.com.    A       93.184.216.50

; Почта (приоритет: чем меньше, тем выше)
example.com.        MX      10 mail.example.com.
example.com.        MX      20 mail-backup.example.com.
mail.example.com.   A       93.184.216.60

; DNS-серверы
example.com.        NS      ns1.provider.com.
example.com.        NS      ns2.provider.com.

; Верификация и защита почты
example.com.        TXT     "v=spf1 include:_spf.google.com ~all"
```

## TTL (Time To Live)

Время жизни записи в кэше (в секундах):

```
example.com.  300  IN  A  93.184.216.34
              ↑
           TTL = 5 минут
```

| TTL | Время | Использование |
|-----|-------|---------------|
| 60-300 | 1-5 мин | Частые изменения, перед миграцией |
| 3600 | 1 час | Обычные сайты |
| 86400 | 24 часа | Стабильные записи |

**Совет:** перед сменой сервера уменьши TTL заранее, чтобы переход был быстрым.

## Публичные DNS-серверы

| Провайдер | IPv4 | Особенности |
|-----------|------|-------------|
| Google | 8.8.8.8, 8.8.4.4 | Быстрый, надёжный |
| Cloudflare | 1.1.1.1 | Самый быстрый, приватность |
| Яндекс | 77.88.8.8 | Русскоязычный, фильтры |
| Quad9 | 9.9.9.9 | Блокирует вредоносные сайты |

Можно использовать вместо DNS провайдера (часто быстрее и надёжнее).

## Проверка DNS (команды)

```bash
# Узнать IP домена
nslookup google.com
dig google.com

# Все записи
dig example.com ANY

# Конкретный тип записи
dig example.com MX
dig example.com TXT

# Через конкретный DNS-сервер
dig @8.8.8.8 example.com

# Трассировка запроса (весь путь)
dig +trace example.com
```

## DNS и безопасность

### Проблемы
- **DNS Spoofing** — подмена ответов (перенаправление на фишинговый сайт)
- **DNS не шифруется** — провайдер видит, какие сайты ты посещаешь

### Решения
- **DNSSEC** — криптографическая подпись записей
- **DoH (DNS over HTTPS)** — DNS-запросы через HTTPS
- **DoT (DNS over TLS)** — DNS-запросы через TLS

Современные браузеры поддерживают DoH (можно включить в настройках).

# IP Addresses

## Что такое IP-адрес?

**IP-адрес (Internet Protocol Address)** — это уникальный числовой идентификатор устройства в сети, работающей по протоколу IP. Это как почтовый адрес для компьютера — он нужен, чтобы данные знали, куда идти.

---

## IPv4 (Internet Protocol version 4)

### Формат IPv4

IPv4-адрес состоит из **32 бит**, разделённых на 4 октета (по 8 бит каждый).

```
Десятичный вид:     192.168.1.100
                     │   │   │  │
                     └───┴───┴──┴── 4 октета (0-255 каждый)

Двоичный вид:       11000000.10101000.00000001.01100100

Всего адресов:      2^32 = 4 294 967 296 (около 4.3 миллиарда)
```

### Перевод между форматами

```
Октет:     192
Двоичный:  128 + 64 + 0 + 0 + 0 + 0 + 0 + 0 = 192
           1    1    0   0   0   0   0   0
           ↑    ↑    ↑   ↑   ↑   ↑   ↑   ↑
          128  64   32  16   8   4   2   1
```

**Пример перевода 192.168.1.1 в двоичный:**
```
192 = 11000000
168 = 10101000
  1 = 00000001
  1 = 00000001

Результат: 11000000.10101000.00000001.00000001
```

---

## Классы IP-адресов (устаревшая классификация)

Исторически IPv4 делился на классы, но сейчас используется CIDR.

```
┌───────┬──────────────────────────┬─────────────────┬────────────────┐
│ Класс │      Диапазон            │  Маска по умолч.│  Назначение    │
├───────┼──────────────────────────┼─────────────────┼────────────────┤
│   A   │ 1.0.0.0 - 126.255.255.255│  255.0.0.0 (/8) │ Крупные сети   │
│   B   │ 128.0.0.0 - 191.255.255.255│ 255.255.0.0 (/16)│ Средние сети │
│   C   │ 192.0.0.0 - 223.255.255.255│ 255.255.255.0 (/24)│ Малые сети │
│   D   │ 224.0.0.0 - 239.255.255.255│      —        │ Multicast      │
│   E   │ 240.0.0.0 - 255.255.255.255│      —        │ Зарезервировано│
└───────┴──────────────────────────┴─────────────────┴────────────────┘
```

---

## Публичные и приватные адреса

### Приватные (Private) адреса

Зарезервированы для локальных сетей. **Не маршрутизируются в Интернете!**

```
┌─────────────────────────────────┬─────────────────────┬───────────────┐
│           Диапазон              │        Маска        │  Класс (стар.)│
├─────────────────────────────────┼─────────────────────┼───────────────┤
│ 10.0.0.0 - 10.255.255.255       │ 10.0.0.0/8          │      A        │
│ 172.16.0.0 - 172.31.255.255     │ 172.16.0.0/12       │      B        │
│ 192.168.0.0 - 192.168.255.255   │ 192.168.0.0/16      │      C        │
└─────────────────────────────────┴─────────────────────┴───────────────┘
```

**Примеры использования:**
- 192.168.0.1 — типичный адрес домашнего роутера
- 10.0.0.0/8 — часто используется в корпоративных сетях
- 172.16.x.x — VPN, внутренние сервисы

### Публичные (Public) адреса

Уникальные адреса в Интернете. Выдаются провайдерами (ISP).

```
Пример: 8.8.8.8 (DNS Google)
        1.1.1.1 (DNS Cloudflare)
```

### Как это работает вместе (NAT)

```
         Интернет
            │
    Публичный IP: 203.0.113.50
            │
       ┌────┴────┐
       │  Router │ ← NAT (Network Address Translation)
       │  (NAT)  │
       └────┬────┘
            │
    Приватная сеть 192.168.1.0/24
       ┌────┴────┐
       │  Switch │
       └─┬──┬──┬─┘
         │  │  │
    .10  │  │.20│  .30
    PC1  PC2    PC3
```

**NAT** позволяет множеству устройств с приватными IP выходить в Интернет через один публичный IP.

---

## Специальные адреса

```
┌─────────────────────────┬────────────────────────────────────────────┐
│         Адрес           │              Назначение                    │
├─────────────────────────┼────────────────────────────────────────────┤
│ 0.0.0.0                 │ "Любой адрес" или неизвестный источник     │
│ 127.0.0.0/8             │ Loopback (localhost) — сам компьютер       │
│ 127.0.0.1               │ localhost — чаще всего используется        │
│ 169.254.0.0/16          │ Link-local (APIPA) — автоконфигурация      │
│ 255.255.255.255         │ Широковещательный (broadcast) адрес        │
└─────────────────────────┴────────────────────────────────────────────┘
```

---

## Маска подсети (Subnet Mask)

Маска определяет, какая часть IP-адреса относится к **сети**, а какая — к **хосту**.

```
IP-адрес:    192.168.1.100
Маска:       255.255.255.0
             └─────┬─────┘ └┬┘
             Сетевая часть  Хостовая часть

В двоичном виде:
IP:     11000000.10101000.00000001.01100100
Маска:  11111111.11111111.11111111.00000000
        └───────────сеть──────────┘└─хост─┘
```

### Как узнать сетевую часть?

Побитовое AND между IP и маской:

```
IP:       192.168.1.100   = 11000000.10101000.00000001.01100100
Маска:    255.255.255.0   = 11111111.11111111.11111111.00000000
                            ─────────────────────────────────────
Сеть:     192.168.1.0     = 11000000.10101000.00000001.00000000
```

---

## CIDR (Classless Inter-Domain Routing)

CIDR заменил классовую адресацию и позволяет гибко выделять блоки адресов.

### Нотация CIDR

```
192.168.1.0/24
            └── количество бит в сетевой части (префикс)

/24 означает маску 255.255.255.0 (24 единицы подряд)
```

### Популярные маски

```
┌────────┬───────────────────┬───────────────┬───────────────────┐
│ CIDR   │      Маска        │ Кол-во хостов │     Пример        │
├────────┼───────────────────┼───────────────┼───────────────────┤
│  /8    │ 255.0.0.0         │  16,777,214   │ 10.0.0.0/8        │
│  /16   │ 255.255.0.0       │     65,534    │ 172.16.0.0/16     │
│  /24   │ 255.255.255.0     │       254     │ 192.168.1.0/24    │
│  /25   │ 255.255.255.128   │       126     │ 192.168.1.0/25    │
│  /26   │ 255.255.255.192   │        62     │ 192.168.1.0/26    │
│  /27   │ 255.255.255.224   │        30     │ 192.168.1.0/27    │
│  /28   │ 255.255.255.240   │        14     │ 192.168.1.0/28    │
│  /29   │ 255.255.255.248   │         6     │ 192.168.1.0/29    │
│  /30   │ 255.255.255.252   │         2     │ 192.168.1.0/30    │
│  /32   │ 255.255.255.255   │         1     │ 192.168.1.1/32    │
└────────┴───────────────────┴───────────────┴───────────────────┘

Формула: количество хостов = 2^(32-prefix) - 2
         минус 2, потому что сетевой адрес и broadcast не используются для хостов
```

### Пример разбиения на подсети (subnetting)

Задача: разделить сеть 192.168.1.0/24 на 4 подсети

```
Исходная сеть: 192.168.1.0/24 (256 адресов)

Нужны 4 подсети → добавляем 2 бита к маске (/24 + 2 = /26)
Каждая подсеть: 2^(32-26) = 64 адреса (62 для хостов)

Подсеть 1: 192.168.1.0/26   (хосты: .1 - .62, broadcast: .63)
Подсеть 2: 192.168.1.64/26  (хосты: .65 - .126, broadcast: .127)
Подсеть 3: 192.168.1.128/26 (хосты: .129 - .190, broadcast: .191)
Подсеть 4: 192.168.1.192/26 (хосты: .193 - .254, broadcast: .255)
```

---

## IPv6 (Internet Protocol version 6)

### Почему IPv6?

- IPv4 адресов не хватает (4.3 млрд на 8 млрд людей + IoT устройства)
- IPv6 имеет 2^128 адресов (340 ундециллионов!)

### Формат IPv6

```
IPv6 адрес: 128 бит, записывается в шестнадцатеричном виде

Полный формат:
2001:0db8:0000:0000:0000:0000:0000:0001

Сокращённый (убираем ведущие нули, :: заменяет группы нулей):
2001:db8::1
```

### Правила сокращения IPv6

```
1. Убираем ведущие нули в каждой группе:
   2001:0db8:0000:0042 → 2001:db8:0:42

2. Одну последовательность нулевых групп заменяем на ::
   2001:0db8:0000:0000:0000:0000:0000:0001 → 2001:db8::1

3. :: можно использовать только ОДИН раз в адресе!
```

### Типы IPv6 адресов

```
┌──────────────────┬─────────────────────────────────────────────────┐
│      Тип         │                  Описание                       │
├──────────────────┼─────────────────────────────────────────────────┤
│ Global Unicast   │ Публичные адреса (2000::/3)                     │
│ Link-Local       │ Локальные адреса (fe80::/10), автоконфигурация  │
│ Unique Local     │ Приватные адреса (fc00::/7), аналог 10.x.x.x    │
│ Loopback         │ ::1 (аналог 127.0.0.1)                          │
│ Multicast        │ ff00::/8                                        │
└──────────────────┴─────────────────────────────────────────────────┘
```

### Примеры IPv6

```
Localhost:        ::1
Google DNS:       2001:4860:4860::8888
Cloudflare DNS:   2606:4700:4700::1111
```

---

## Статические и динамические IP

### Статический IP
Настраивается вручную, не меняется.

```bash
# Linux: настройка статического IP
sudo ip addr add 192.168.1.100/24 dev eth0
sudo ip route add default via 192.168.1.1
```

### Динамический IP (DHCP)
Назначается автоматически DHCP-сервером.

```
Процесс получения IP (DORA):
1. DISCOVER: Клиент ищет DHCP-сервер (broadcast)
2. OFFER: Сервер предлагает IP-адрес
3. REQUEST: Клиент запрашивает предложенный IP
4. ACK: Сервер подтверждает выдачу
```

---

## Практика: команды для работы с IP

```bash
# Узнать свой IP-адрес
ip addr                          # Linux
ifconfig                         # macOS
ipconfig                         # Windows

# Узнать публичный IP
curl ifconfig.me
curl ipinfo.io/ip

# Проверить связь с хостом
ping 8.8.8.8
ping -6 2001:4860:4860::8888     # IPv6

# Обновить DHCP-адрес
sudo dhclient -r && sudo dhclient  # Linux
ipconfig /release && ipconfig /renew  # Windows

# Показать таблицу ARP (соответствие IP-MAC)
arp -a

# Узнать информацию об IP-адресе
whois 8.8.8.8
```

---

## Практический пример: расчёт подсети

**Задача:** Дан IP 172.16.50.100/20. Найти:
1. Адрес сети
2. Broadcast-адрес
3. Диапазон хостов
4. Количество хостов

**Решение:**

```
IP:   172.16.50.100 = 10101100.00010000.00110010.01100100
Маска /20:           = 11111111.11111111.11110000.00000000
                                           ↑
                                     20 бит = сеть

1. Адрес сети (AND):
   IP & Mask = 10101100.00010000.00110000.00000000 = 172.16.48.0

2. Broadcast (все хостовые биты = 1):
   172.16.48.0 → 172.16.0011 1111.11111111 = 172.16.63.255

3. Диапазон хостов:
   Первый: 172.16.48.1
   Последний: 172.16.63.254

4. Количество хостов:
   2^(32-20) - 2 = 2^12 - 2 = 4094 хоста
```

---

## Ключевые моменты для backend-разработчика

1. **127.0.0.1 (localhost)** — для локальной разработки и тестирования
2. **0.0.0.0** — сервер слушает на всех интерфейсах
3. **Приватные сети** — для внутренних сервисов (Docker, Kubernetes)
4. **NAT** — понимание как приватные IP связаны с публичными
5. **CIDR** — для настройки правил файрволла и маршрутизации

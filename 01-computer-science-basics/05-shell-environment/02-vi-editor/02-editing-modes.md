# Режимы редактирования Vi (Editing Modes)

## Основная концепция

Vi — **модальный редактор**. Это означает, что одни и те же клавиши выполняют разные действия в зависимости от текущего режима.

В отличие от обычных редакторов (где нажатие клавиши сразу вводит символ), в Vi большинство клавиш — это команды.

## Основные режимы

### 1. Normal Mode (Обычный режим)

**Режим по умолчанию** — vi запускается именно в нём.

**Назначение:**
- Навигация по тексту
- Удаление, копирование, вставка
- Выполнение команд редактирования

**Клавиши в Normal mode — это команды, а не символы:**

```
h, j, k, l — перемещение курсора
dd         — удалить строку
yy         — копировать строку
p          — вставить
u          — отменить
```

**Как вернуться в Normal mode:**
```
Esc        — из любого режима
Ctrl+[     — альтернатива Esc (ближе к рукам)
Ctrl+C     — тоже работает (с предупреждениями в некоторых случаях)
```

### 2. Insert Mode (Режим вставки)

**Режим ввода текста** — клавиши вводят символы как в обычном редакторе.

**Как войти в Insert mode (из Normal mode):**

```
i    — вставка перед курсором (insert)
I    — вставка в начало строки
a    — вставка после курсора (append)
A    — вставка в конец строки
o    — новая строка ниже (open)
O    — новая строка выше
```

**Визуальный индикатор:**
```
-- INSERT --    (внизу экрана)
```

**Выход из Insert mode:**
```
Esc    — вернуться в Normal mode
```

**Пример работы:**
```
# Открыть файл (vi запускается в Normal mode)
vi file.txt

# Нажать i — перейти в Insert mode
# Ввести текст: Hello, World!
# Нажать Esc — вернуться в Normal mode
# Нажать :wq — сохранить и выйти
```

### 3. Command-Line Mode (Командный режим)

**Режим ввода Ex-команд** — для сложных операций.

**Как войти:**
```
:    — команды Ex (сохранение, выход, поиск с заменой)
/    — поиск вперёд
?    — поиск назад
```

**Визуальный индикатор:**
```
:           (двоеточие в нижней строке)
/pattern    (для поиска)
```

**Основные Ex-команды:**
```
:w           — сохранить (write)
:q           — выйти (quit)
:wq          — сохранить и выйти
:q!          — выйти без сохранения
:e filename  — открыть файл (edit)
:help        — справка
```

**Выход из Command mode:**
```
Enter   — выполнить команду
Esc     — отменить и вернуться в Normal mode
```

### 4. Visual Mode (Визуальный режим)

**Режим выделения текста** — для выбора блоков текста.

**Как войти (из Normal mode):**
```
v       — посимвольное выделение
V       — построчное выделение
Ctrl+v  — блочное (колоночное) выделение
```

**Визуальный индикатор:**
```
-- VISUAL --         (посимвольное)
-- VISUAL LINE --    (построчное)
-- VISUAL BLOCK --   (блочное)
```

**После выделения можно:**
```
d   — удалить выделенное
y   — копировать выделенное
c   — изменить выделенное (удалить и перейти в Insert mode)
>   — сдвинуть вправо (отступ)
<   — сдвинуть влево
```

## Схема переходов между режимами

```
                    +----------------+
                    |  Normal Mode   |
                    | (по умолчанию) |
                    +-------+--------+
                            |
         +------------------+------------------+
         |                  |                  |
    i, a, o...          :, /, ?           v, V, Ctrl+v
         |                  |                  |
         v                  v                  v
  +------+------+   +-------+-------+   +------+------+
  | Insert Mode |   | Command Mode  |   | Visual Mode |
  +------+------+   +-------+-------+   +------+------+
         |                  |                  |
         +------------------+------------------+
                            |
                          Esc
                            |
                            v
                    +----------------+
                    |  Normal Mode   |
                    +----------------+
```

## Команды перехода в Insert Mode

Разные команды начинают вставку в разных позициях:

```
      I                    i   a                    A
      |                    |   |                    |
      v                    v   v                    v
|-----+--------------------+---+--------------------+-----|
^начало строки          курсор                    конец^

O  — новая строка выше
o  — новая строка ниже
```

**Примеры использования:**

```
# Добавить текст в начало строки
I

# Добавить текст в конец строки
A

# Добавить новую строку и начать ввод
o

# Вставить перед символом под курсором
i

# Вставить после символа под курсором
a
```

## Дополнительные способы входа в Insert Mode

```
s    — удалить символ и войти в Insert (substitute)
S    — удалить всю строку и войти в Insert
cc   — удалить строку и войти в Insert (change line)
cw   — удалить слово и войти в Insert (change word)
C    — удалить от курсора до конца строки и войти в Insert
```

## Replace Mode (Режим замены)

Особый режим, где ввод заменяет существующие символы:

```
R    — войти в Replace mode
```

**Визуальный индикатор:**
```
-- REPLACE --
```

**Пример:**
```
# Текст: Hello World
# Курсор на 'W'
# Нажать R, ввести "Earth"
# Результат: Hello Earth
```

## Практические советы

### 1. Всегда знайте текущий режим

Смотрите на индикатор внизу экрана:
- Пусто или имя файла → Normal mode
- `-- INSERT --` → Insert mode
- `-- VISUAL --` → Visual mode

### 2. При сомнении — жмите Esc

```
# Не знаете в каком режиме? Нажмите Esc (можно несколько раз)
Esc Esc

# Вы гарантированно вернётесь в Normal mode
```

### 3. Используйте правильную команду входа

```
# Добавить текст в конец строки
# НЕЭФФЕКТИВНО: lllllllli (много перемещений, потом i)
# ЭФФЕКТИВНО: A (сразу в конец и в Insert mode)
```

### 4. Не застревайте в Insert mode

Многие новички остаются в Insert mode и используют стрелки для навигации.

**Правильный подход:**
```
1. Ввести текст (Insert mode)
2. Esc (вернуться в Normal mode)
3. Навигация (Normal mode)
4. Снова i/a/o когда нужно печатать
```

## Сравнение с обычными редакторами

| Действие | Обычный редактор | Vi |
|----------|------------------|-----|
| Ввод текста | Сразу печатает | Нужен Insert mode (i) |
| Удаление строки | Выделить + Delete | dd (Normal mode) |
| Копирование | Ctrl+C | yy (Normal mode) |
| Вставка | Ctrl+V | p (Normal mode) |
| Перемещение | Стрелки/мышь | hjkl (Normal mode) |

## Резюме

- **Normal mode** — режим по умолчанию, для навигации и команд
- **Insert mode** — для ввода текста (i, a, o и др.)
- **Command mode** — для Ex-команд (:, /, ?)
- **Visual mode** — для выделения текста (v, V, Ctrl+v)
- **Esc** — универсальный выход в Normal mode
- Модальность позволяет использовать простые клавиши для мощных команд

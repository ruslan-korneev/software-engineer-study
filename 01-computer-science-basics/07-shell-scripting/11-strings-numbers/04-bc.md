# Калькулятор bc

## Что такое bc

`bc` (Basic Calculator) - это язык программирования и калькулятор произвольной точности. Используется в bash для:
- Вычислений с плавающей точкой
- Работы с большими числами
- Сложных математических операций

## Базовое использование

```bash
# Простое вычисление
echo "5 + 3" | bc        # 8

# Несколько операций
echo "5 + 3; 10 - 2" | bc
# 8
# 8

# Через here string
bc <<< "5 + 3"           # 8
```

## Арифметические операции

```bash
#!/bin/bash

# Сложение и вычитание
echo "10.5 + 3.2" | bc   # 13.7
echo "10.5 - 3.2" | bc   # 7.3

# Умножение и деление
echo "10 * 3" | bc       # 30
echo "10 / 3" | bc       # 3 (целочисленное!)

# Деление с точностью
echo "scale=2; 10 / 3" | bc     # 3.33
echo "scale=4; 10 / 3" | bc     # 3.3333

# Остаток от деления
echo "10 % 3" | bc       # 1

# Возведение в степень
echo "2 ^ 10" | bc       # 1024
```

## Переменная scale

`scale` определяет количество знаков после запятой:

```bash
#!/bin/bash

# По умолчанию scale=0 (целочисленное деление)
echo "1 / 3" | bc                # 0

# Установка scale
echo "scale=2; 1 / 3" | bc       # .33
echo "scale=5; 1 / 3" | bc       # .33333
echo "scale=10; 1 / 3" | bc      # .3333333333
```

## Опция -l (math library)

Загружает математическую библиотеку и устанавливает scale=20:

```bash
#!/bin/bash

# Без -l
echo "sqrt(2)" | bc        # Ошибка

# С -l
echo "sqrt(2)" | bc -l     # 1.41421356237309504880

# Доступные функции с -l:
echo "s(0)" | bc -l        # 0 (sin)
echo "c(0)" | bc -l        # 1 (cos)
echo "a(1)" | bc -l        # .78... (atan, pi/4)
echo "l(10)" | bc -l       # 2.30... (натуральный логарифм)
echo "e(1)" | bc -l        # 2.71... (e^x)
```

## Математические функции

### Встроенные (с -l)

| Функция | Описание |
|---------|----------|
| `s(x)` | Синус (x в радианах) |
| `c(x)` | Косинус |
| `a(x)` | Арктангенс |
| `l(x)` | Натуральный логарифм |
| `e(x)` | e в степени x |
| `sqrt(x)` | Квадратный корень |

```bash
#!/bin/bash

# Вычисление Pi
echo "scale=10; 4*a(1)" | bc -l  # 3.1415926532

# Квадратный корень
echo "scale=4; sqrt(2)" | bc     # 1.4142

# e (число Эйлера)
echo "scale=10; e(1)" | bc -l    # 2.7182818284
```

## Сравнения и логика

```bash
#!/bin/bash

# Сравнение возвращает 1 (true) или 0 (false)
echo "5 > 3" | bc        # 1
echo "5 < 3" | bc        # 0
echo "5 == 5" | bc       # 1
echo "5 != 3" | bc       # 1
echo "5 >= 5" | bc       # 1
echo "5 <= 3" | bc       # 0

# Логические операции
echo "1 && 1" | bc       # 1
echo "1 && 0" | bc       # 0
echo "1 || 0" | bc       # 1
echo "!0" | bc           # 1
```

## Переменные в bc

```bash
#!/bin/bash

# Присваивание и использование переменных
bc << EOF
x = 10
y = 3
z = x + y
z
EOF
# Вывод: 13

# Через -l
bc -l << EOF
scale = 4
pi = 4 * a(1)
r = 5
area = pi * r * r
area
EOF
```

## Программирование в bc

### Условия

```bash
bc << EOF
x = 10
if (x > 5) {
    print "больше 5\n"
}
EOF
```

### Циклы

```bash
bc << EOF
for (i = 1; i <= 5; i++) {
    print i, " "
}
print "\n"
EOF
# 1 2 3 4 5
```

### Функции

```bash
bc << EOF
define factorial(n) {
    if (n <= 1) return 1
    return n * factorial(n - 1)
}

factorial(5)
EOF
# 120
```

## Практические примеры

### Процентные вычисления

```bash
#!/bin/bash

calc_percent() {
    local value=$1
    local percent=$2
    echo "scale=2; $value * $percent / 100" | bc
}

# 20% от 150
calc_percent 150 20  # 30.00
```

### Конвертация температур

```bash
#!/bin/bash

celsius_to_fahrenheit() {
    echo "scale=2; ($1 * 9/5) + 32" | bc
}

fahrenheit_to_celsius() {
    echo "scale=2; ($1 - 32) * 5/9" | bc
}

celsius_to_fahrenheit 100  # 212.00
fahrenheit_to_celsius 98.6 # 37.00
```

### Финансовые расчёты

```bash
#!/bin/bash

# Сложный процент
compound_interest() {
    local principal=$1    # Начальная сумма
    local rate=$2         # Годовая ставка (в десятичном виде)
    local periods=$3      # Количество периодов

    bc -l << EOF
scale = 2
result = $principal * (1 + $rate) ^ $periods
result
EOF
}

# $1000 под 5% на 10 лет
compound_interest 1000 0.05 10  # 1628.89
```

### Среднее значение

```bash
#!/bin/bash

average() {
    local sum=0
    local count=$#

    for num in "$@"; do
        sum=$(echo "$sum + $num" | bc)
    done

    echo "scale=2; $sum / $count" | bc
}

average 10 20 30 40 50  # 30.00
```

### Округление

```bash
#!/bin/bash

# Округление до N знаков
round() {
    local number=$1
    local places=${2:-2}

    echo "scale=$places; ($number + 0.5 * 10^(-$places)) / 1" | bc
}

# Округление вверх (ceiling)
ceil() {
    echo "scale=0; ($1 + 0.9999999) / 1" | bc
}

# Округление вниз (floor)
floor() {
    echo "scale=0; $1 / 1" | bc
}

round 3.14159 2  # 3.14
ceil 3.1         # 4
floor 3.9        # 3
```

## Использование в скриптах

```bash
#!/bin/bash

# Сравнение чисел с плавающей точкой
float_cmp() {
    local result
    result=$(echo "$1 $2 $3" | bc)
    return $((1 - result))
}

a="3.14"
b="2.71"

if float_cmp "$a" ">" "$b"; then
    echo "$a больше $b"
fi

# Проверка равенства с погрешностью
float_eq() {
    local diff
    diff=$(echo "scale=10; $1 - $2" | bc)
    diff=${diff#-}  # Абсолютное значение
    result=$(echo "$diff < 0.0001" | bc)
    return $((1 - result))
}
```

# Команда cp

## Что такое cp?

**cp** (copy) — команда для копирования файлов и директорий.

## Синтаксис

```bash
cp [опции] источник назначение
cp [опции] источник... директория
```

## Базовое использование

### Копирование файла
```bash
$ cp file.txt copy.txt           # копия в той же папке
$ cp file.txt /backup/           # копия в другую директорию
$ cp file.txt /backup/new.txt    # копия с новым именем
```

### Копирование нескольких файлов
```bash
$ cp file1.txt file2.txt file3.txt /backup/
$ cp *.txt /backup/              # все .txt файлы
```

## Основные опции

### -r, -R (recursive) — рекурсивное копирование директорий

```bash
$ cp mydir /backup/
cp: omitting directory 'mydir'

$ cp -r mydir /backup/           # теперь работает
```

### -i (interactive) — запрос подтверждения

```bash
$ cp -i file.txt existing.txt
cp: overwrite 'existing.txt'? y
```

### -n (no-clobber) — не перезаписывать

```bash
$ cp -n file.txt existing.txt
# Не перезапишет existing.txt
```

### -u (update) — копировать только если новее

```bash
$ cp -u source.txt dest.txt
# Скопирует только если source.txt новее dest.txt
```

### -v (verbose) — подробный вывод

```bash
$ cp -v file.txt /backup/
'file.txt' -> '/backup/file.txt'
```

### -p (preserve) — сохранить атрибуты

```bash
$ cp -p file.txt copy.txt
# Сохраняет время изменения, владельца, права
```

### -a (archive) — архивное копирование

Эквивалент `-dR --preserve=all`. Сохраняет всё: права, владельца, ссылки, время:

```bash
$ cp -a mydir /backup/
```

### -l (link) — создать жёсткие ссылки

```bash
$ cp -l file.txt link.txt
# link.txt — жёсткая ссылка на file.txt
```

### -s (symbolic-link) — создать символические ссылки

```bash
$ cp -s file.txt symlink.txt
# symlink.txt — символическая ссылка
```

## Практические примеры

### Бэкап файла перед редактированием
```bash
$ cp config.yaml config.yaml.bak
$ cp config.yaml config.yaml.$(date +%Y%m%d)
```

### Копирование проекта
```bash
$ cp -r myproject myproject-backup
$ cp -a myproject /backup/       # с сохранением всех атрибутов
```

### Обновление файлов
```bash
$ cp -u *.txt /backup/           # только изменённые
$ cp -ru project/ /backup/       # рекурсивно, только новые
```

### Копирование с wildcards
```bash
$ cp *.{jpg,png,gif} images/     # все изображения
$ cp report-*.pdf reports/       # все отчёты
```

### Безопасное копирование
```bash
$ cp -iv file.txt /backup/       # подробно + подтверждение
```

## Копирование директорий

### Простое копирование
```bash
$ cp -r source/ dest/
```

### В существующую директорию
```bash
$ cp -r source/ /path/to/existing/
# Создаст /path/to/existing/source/
```

### Содержимое директории (без самой директории)
```bash
$ cp -r source/* dest/
$ cp -r source/. dest/           # включая скрытые файлы
```

## Поведение с директориями назначения

```bash
# Если dest НЕ существует — создаёт новую директорию dest
$ cp -r source dest

# Если dest существует — копирует ВНУТРЬ
$ cp -r source dest
# Результат: dest/source/
```

Чтобы копировать содержимое:
```bash
$ cp -r source/. dest/
# или
$ cp -rT source dest   # GNU cp
```

## Обработка ошибок

### Нет прав на чтение источника
```bash
$ cp /root/secret.txt ~/
cp: cannot open '/root/secret.txt': Permission denied
```

### Нет прав на запись в назначение
```bash
$ cp file.txt /etc/
cp: cannot create regular file '/etc/file.txt': Permission denied
```

### Файл не существует
```bash
$ cp nonexistent.txt /backup/
cp: cannot stat 'nonexistent.txt': No such file or directory
```

## Сравнение опций

| Опция | Описание |
|-------|----------|
| `-r` | Копировать директории рекурсивно |
| `-p` | Сохранить права, время, владельца |
| `-a` | `-r` + `-p` + сохранить ссылки |
| `-u` | Только если источник новее |
| `-n` | Не перезаписывать существующие |
| `-i` | Спрашивать перед перезаписью |
| `-v` | Показывать что копируется |

## Советы

1. **Для бэкапов используйте -a**:
   ```bash
   cp -a important/ backup/
   ```

2. **Используйте -i для важных операций**:
   ```bash
   cp -i *.txt /important/
   ```

3. **Проверяйте wildcards перед копированием**:
   ```bash
   echo cp *.log /archive/   # сначала посмотрите что скопируется
   ```

4. **Для синхронизации лучше rsync**:
   ```bash
   rsync -av source/ dest/   # умнее, чем cp
   ```

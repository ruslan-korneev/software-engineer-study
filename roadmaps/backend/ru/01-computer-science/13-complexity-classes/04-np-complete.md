# NP-полные задачи (NP-Complete)

[prev: 03-class-np](./03-class-np.md) | [next: 05-np-hard](./05-np-hard.md)
---

## Определение

### Формальное определение

Задача L является **NP-полной** (NP-complete), если:

1. **L ∈ NP** — задача лежит в классе NP
2. **L является NP-трудной** — любая задача из NP сводится к L за полиномиальное время

```
L ∈ NP-complete ⟺ (L ∈ NP) ∧ (∀ A ∈ NP: A ≤ₚ L)

где ≤ₚ означает полиномиальную сводимость
```

### Интуитивное объяснение

NP-полные задачи — это "самые сложные" задачи в NP:

- Если найти полиномиальный алгоритм для **любой** NP-полной задачи → **P = NP**
- Если доказать, что **любая** NP-полная задача не решается за полиномиальное время → **P ≠ NP**

```
┌────────────────────────────────────────────────────────────────┐
│                      NP-ПОЛНОТА                                │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│   NP-полные задачи — "вершина сложности" внутри NP             │
│                                                                │
│   Все NP-полные задачи эквивалентны по сложности:              │
│   • Если одна решается за P → все решаются за P                │
│   • Если одна НЕ в P → все НЕ в P                              │
│                                                                │
│                    ┌─────────────────┐                         │
│                    │  NP-complete    │                         │
│                    │  SAT, CLIQUE,   │                         │
│                    │  TSP, 3-COLOR   │                         │
│                    └────────┬────────┘                         │
│                             │                                  │
│          ┌──────────────────┼──────────────────┐               │
│          ▼                  ▼                  ▼               │
│      ┌───────┐         ┌───────┐         ┌───────┐             │
│      │ Любая │         │ Любая │         │ Любая │             │
│      │ NP    │   ≤ₚ    │ NP    │   ≤ₚ    │ NP    │             │
│      │ задача│         │ задача│         │ задача│             │
│      └───────┘         └───────┘         └───────┘             │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

## Зачем нужно

### Практическое значение

1. **Классификация сложности**: показывает, что задача "по-настоящему сложная"
2. **Стратегия решения**: если задача NP-полная, ищем приближённые алгоритмы
3. **Криптография**: безопасность основана на NP-полных/трудных задачах
4. **Теоретическое значение**: связь с проблемой P vs NP

### Что делать, если задача NP-полная?

```
┌────────────────────────────────────────────────────────────────┐
│      СТРАТЕГИИ ДЛЯ NP-ПОЛНЫХ ЗАДАЧ                             │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  1. ПРИБЛИЖЁННЫЕ АЛГОРИТМЫ                                     │
│     • Гарантированное отклонение от оптимума                   │
│     • Vertex Cover: 2-приближение                              │
│     • TSP (метрический): 1.5-приближение (Кристофидес)         │
│                                                                │
│  2. ЭВРИСТИКИ                                                  │
│     • Жадные алгоритмы                                         │
│     • Генетические алгоритмы                                   │
│     • Имитация отжига                                          │
│     • Муравьиные алгоритмы                                     │
│                                                                │
│  3. ПАРАМЕТРИЗОВАННЫЕ АЛГОРИТМЫ                                │
│     • Эффективны при малом параметре k                         │
│     • Vertex Cover: O(2^k × n) вместо O(n^k)                   │
│                                                                │
│  4. SAT-СОЛВЕРЫ                                                │
│     • Современные решатели очень эффективны                    │
│     • CDCL, DPLL алгоритмы                                     │
│     • Справляются с миллионами переменных                      │
│                                                                │
│  5. ОГРАНИЧЕНИЕ ВХОДНЫХ ДАННЫХ                                 │
│     • Специальные случаи могут быть в P                        │
│     • Планарные графы, деревья и т.д.                          │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

## Полиномиальная сводимость

### Определение

Задача A **полиномиально сводится** к задаче B (A ≤ₚ B), если существует функция f, вычислимая за полиномиальное время, такая что:

```
x ∈ A ⟺ f(x) ∈ B
```

### Визуализация сводимости

```
┌────────────────────────────────────────────────────────────────┐
│                 ПОЛИНОМИАЛЬНАЯ СВОДИМОСТЬ                      │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│    Задача A                    Задача B                        │
│    ┌───────┐                   ┌───────┐                       │
│    │       │    f (poly)       │       │                       │
│    │   x   │ ───────────────►  │  f(x) │                       │
│    │       │                   │       │                       │
│    └───┬───┘                   └───┬───┘                       │
│        │                           │                           │
│        ▼                           ▼                           │
│   x ∈ A (да/нет)   ⟺      f(x) ∈ B (да/нет)                    │
│                                                                │
│    ВАЖНО:                                                      │
│    • f вычисляется за полиномиальное время                     │
│    • Если есть алгоритм для B, получаем алгоритм для A         │
│    • A ≤ₚ B означает "A не сложнее B"                          │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

### Свойства сводимости

```
1. Рефлексивность: A ≤ₚ A

2. Транзитивность: (A ≤ₚ B) ∧ (B ≤ₚ C) ⟹ A ≤ₚ C

3. Если A ≤ₚ B и B ∈ P, то A ∈ P

4. Если A ≤ₚ B и A ∉ P, то B ∉ P
```

## Теорема Кука-Левина

### Формулировка

**SAT является NP-полной задачей.**

Это первая задача, для которой была доказана NP-полнота (1971).

### Идея доказательства

```
┌────────────────────────────────────────────────────────────────┐
│              ТЕОРЕМА КУКА-ЛЕВИНА: ИДЕЯ                         │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  Любую задачу из NP можно закодировать как SAT:                │
│                                                                │
│  1. Берём произвольную задачу L ∈ NP                           │
│                                                                │
│  2. По определению, есть верификатор V и сертификат c          │
│                                                                │
│  3. Работу верификатора V(x, c) = 1 можно записать             │
│     как булеву схему (circuit)                                 │
│                                                                │
│  4. Булева схема преобразуется в формулу КНФ                   │
│                                                                │
│  5. Формула выполнима ⟺ существует сертификат c                │
│                                                                │
│                                                                │
│       Вход x                     Булева формула φ              │
│         │                              │                       │
│         ▼                              ▼                       │
│   ┌───────────────┐            ┌───────────────┐               │
│   │ Верификатор   │    ≡       │     SAT       │               │
│   │   V(x, c)     │            │     φ(y)      │               │
│   └───────────────┘            └───────────────┘               │
│         │                              │                       │
│         ▼                              ▼                       │
│    ∃c: V = 1        ⟺          ∃y: φ(y) = 1                    │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

## Примеры NP-полных задач

### Список классических NP-полных задач

```
┌─────────────────────────────────────────────────────────────────┐
│                  NP-ПОЛНЫЕ ЗАДАЧИ                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ЛОГИЧЕСКИЕ                                                     │
│  • SAT — выполнимость булевой формулы                           │
│  • 3-SAT — SAT с ≤3 литералами в дизъюнкте                      │
│  • CIRCUIT-SAT — выполнимость булевой схемы                     │
│                                                                 │
│  ГРАФОВЫЕ                                                       │
│  • CLIQUE — существует ли клика размера k?                      │
│  • INDEPENDENT-SET — независимое множество размера k?           │
│  • VERTEX-COVER — вершинное покрытие размера k?                 │
│  • HAMPATH — гамильтонов путь                                   │
│  • HAMCYCLE — гамильтонов цикл                                  │
│  • 3-COLORING — раскраска в 3 цвета                             │
│  • DOMINATING-SET — доминирующее множество                      │
│                                                                 │
│  ЧИСЛОВЫЕ                                                       │
│  • SUBSET-SUM — сумма подмножества                              │
│  • PARTITION — разбиение на равные суммы                        │
│  • KNAPSACK — задача о рюкзаке (версия решения)                 │
│  • BIN-PACKING — упаковка в контейнеры                          │
│                                                                 │
│  ПЛАНИРОВАНИЕ                                                   │
│  • JOB-SCHEDULING — планирование задач                          │
│  • TSP (decision) — коммивояжёр ≤ k?                            │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Примеры сводимостей

```
┌────────────────────────────────────────────────────────────────┐
│              ЦЕПОЧКА СВОДИМОСТЕЙ КАРПА (1972)                  │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│                           SAT                                  │
│                            │                                   │
│                            ▼                                   │
│                          3-SAT                                 │
│                         /  |  \                                │
│                        /   |   \                               │
│                       ▼    ▼    ▼                              │
│                  CLIQUE  3-COLOR  VERTEX-COVER                 │
│                     │       │         │                        │
│                     ▼       ▼         ▼                        │
│              INDEPENDENT  CHROMATIC  HAMPATH                   │
│                  SET      NUMBER        │                      │
│                     │                   ▼                      │
│                     ▼               HAMCYCLE                   │
│                 SET-COVER               │                      │
│                                         ▼                      │
│                                       TSP                      │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

## Подробные примеры сводимости

### 3-SAT ≤ₚ CLIQUE

```
Сводимость 3-SAT к CLIQUE:

Вход 3-SAT: формула φ с k дизъюнктами, каждый из ≤3 литералов

Построение графа G:
1. Для каждого литерала в каждом дизъюнкте создаём вершину
2. Соединяем рёбрами вершины из РАЗНЫХ дизъюнктов,
   если они НЕ противоречат друг другу
   (x и ¬x противоречат, x и y не противоречат)

Результат: φ выполнима ⟺ в G есть клика размера k
```

```
Пример:
φ = (x₁ ∨ ¬x₂ ∨ x₃) ∧ (¬x₁ ∨ x₂ ∨ x₃) ∧ (x₁ ∨ x₂ ∨ ¬x₃)

Дизъюнкт 1: x₁, ¬x₂, x₃
Дизъюнкт 2: ¬x₁, x₂, x₃
Дизъюнкт 3: x₁, x₂, ¬x₃

Граф:
       C1:x₁ ───────── C2:x₂ ───────── C3:x₁
          │              │              │
          │              │              │
       C1:¬x₂ ───────── C2:x₃ ───────── C3:x₂
          │              │              │
          │              │              │
       C1:x₃ ───────── C2:¬x₁          C3:¬x₃

(Рёбра только между совместимыми литералами из разных дизъюнктов)

Клика размера 3: {C1:x₁, C2:x₂, C3:x₁} → не клика (C1:x₁ и C2 связаны?)
Клика размера 3: {C1:x₃, C2:x₃, C3:x₂} → клика!

Это соответствует присваиванию: x₃ = true, x₂ = true (x₁ любое)
```

### VERTEX-COVER ≤ₚ INDEPENDENT-SET

```
Теорема: S — вершинное покрытие графа G ⟺ V \ S — независимое множество

Следствие: VERTEX-COVER(G, k) = INDEPENDENT-SET(G, n-k)

Пример:
       A --- B
       |     |
       C --- D

Вершинное покрытие размера 2: {A, D} или {B, C}
Независимое множество размера 2: {B, C} или {A, D}

Заметим: {A, D} ∪ {B, C} = {A, B, C, D} и эти множества не пересекаются!
```

## Диаграмма классов сложности

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│                        NP-hard                                  │
│    ┌─────────────────────────────────────────────────────────┐  │
│    │                                                         │  │
│    │                        NP                               │  │
│    │    ┌─────────────────────────────────────────────────┐  │  │
│    │    │                                                 │  │  │
│    │    │              NP-complete                        │  │  │
│    │    │    ┌───────────────────────────────────────┐    │  │  │
│    │    │    │  SAT, 3-SAT, CLIQUE, VERTEX-COVER,    │    │  │  │
│    │    │    │  HAMPATH, TSP-DECISION, 3-COLOR,      │    │  │  │
│    │    │    │  SUBSET-SUM, PARTITION, KNAPSACK      │    │  │  │
│    │    │    └───────────────────────────────────────┘    │  │  │
│    │    │                                                 │  │  │
│    │    │                    P                            │  │  │
│    │    │    ┌───────────────────────────────────────┐    │  │  │
│    │    │    │  Sorting, Searching, Shortest Path,   │    │  │  │
│    │    │    │  2-SAT, PRIMES, Matching               │    │  │  │
│    │    │    └───────────────────────────────────────┘    │  │  │
│    │    │         (Если P ≠ NP, P ⊂ NP-complete)          │  │  │
│    │    │                                                 │  │  │
│    │    └─────────────────────────────────────────────────┘  │  │
│    │                                                         │  │
│    └─────────────────────────────────────────────────────────┘  │
│                                                                 │
│    Halting Problem, TSP-OPTIMIZATION (NP-hard, но не в NP)      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## Как доказать NP-полноту

### Алгоритм доказательства

```
┌────────────────────────────────────────────────────────────────┐
│           ДОКАЗАТЕЛЬСТВО NP-ПОЛНОТЫ ЗАДАЧИ L                   │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  ШАГ 1: Доказать L ∈ NP                                        │
│  • Описать сертификат (полиномиального размера)                │
│  • Показать, что верификатор работает за полиномиальное время  │
│                                                                │
│  ШАГ 2: Выбрать известную NP-полную задачу L'                  │
│  • Обычно берут SAT, 3-SAT, CLIQUE, VERTEX-COVER               │
│                                                                │
│  ШАГ 3: Построить сводимость L' ≤ₚ L                           │
│  • Описать функцию преобразования f                            │
│  • Доказать: x ∈ L' ⟺ f(x) ∈ L                                 │
│  • Показать, что f вычисляется за полиномиальное время         │
│                                                                │
│  ВЫВОД: L ∈ NP-complete                                        │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

### Пример: доказательство NP-полноты CLIQUE

```
Теорема: CLIQUE является NP-полной задачей

CLIQUE:
  Вход: граф G = (V, E), число k
  Вопрос: содержит ли G клику размера k?

ШАГ 1: CLIQUE ∈ NP
  Сертификат: множество из k вершин
  Верификатор: проверяем, что все k(k-1)/2 пары соединены рёбрами
  Время: O(k²) ⊆ O(n²) — полиномиальное

ШАГ 2: Выбираем 3-SAT (известная NP-полная)

ШАГ 3: Строим 3-SAT ≤ₚ CLIQUE
  [Конструкция описана выше]

ВЫВОД: CLIQUE ∈ NP-complete ∎
```

## Исторический контекст

### Хронология

```
1971    Стивен Кук: теорема о NP-полноте SAT
         │ (независимо: Леонид Левин, 1973)
         │
1972    Ричард Карп: 21 NP-полная задача
         │ "Reducibility Among Combinatorial Problems"
         │
1975    Книга Гэри и Джонсона: каталог NP-полных задач
         │ "Computers and Intractability"
         │
1970s-  Тысячи задач доказаны NP-полными
 80s     │
         │
2000    Институт Клэя: P vs NP — $1,000,000
         │
2010s   Современные SAT-солверы решают огромные экземпляры
```

### 21 задача Карпа (1972)

```
1. SAT                      12. CHROMATIC NUMBER
2. CLIQUE                   13. CLIQUE COVER
3. SET PACKING              14. EXACT COVER
4. VERTEX COVER             15. 3D MATCHING
5. SET COVER                16. STEINER TREE
6. FEEDBACK NODE SET        17. HITTING SET
7. FEEDBACK ARC SET         18. KNAPSACK
8. DIRECTED HAMILTONIAN     19. JOB SEQUENCING
9. UNDIRECTED HAMILTONIAN   20. PARTITION
10. 3-SAT                   21. MAX CUT
11. 0-1 INTEGER PROGRAMMING
```

## Практическое применение

### Распознавание NP-полных задач

```python
def recognize_np_complete_pattern(problem_description):
    """
    Паттерны, указывающие на NP-полноту:
    """
    patterns = {
        "Найти подмножество с заданным свойством": "SUBSET-SUM like",
        "Разбить на k групп": "PARTITION / BIN-PACKING like",
        "Найти путь через все вершины": "HAMPATH / TSP like",
        "Раскрасить в k цветов без конфликтов": "k-COLORING",
        "Найти клику / независимое множество": "CLIQUE / INDEPENDENT-SET",
        "Покрыть все элементы минимальным набором": "SET-COVER / VERTEX-COVER",
        "Выполнить булеву формулу": "SAT / 3-SAT",
    }
    # На практике: если задача "выглядит сложно" и связана
    # с комбинаторным перебором — скорее всего NP-полная
```

### Важные следствия NP-полноты

```
Если задача L NP-полна:

1. НЕТ известного полиномиального алгоритма
   (и скорее всего не существует, если P ≠ NP)

2. Для точного решения в худшем случае
   потребуется экспоненциальное время

3. ЕСТЬ надежда:
   • Средний случай может быть проще
   • Приближённые решения часто эффективны
   • Специальные подклассы могут быть в P
   • SAT-солверы работают удивительно хорошо
```

## Итоги

1. **NP-полные задачи** — самые сложные в NP, эквивалентны друг другу
2. **Сводимость A ≤ₚ B** — A не сложнее B за полиномиальное время
3. **Теорема Кука-Левина**: SAT — первая NP-полная задача
4. **21 задача Карпа** — основа теории NP-полноты
5. **Доказательство NP-полноты**: L ∈ NP + сводимость от известной NP-полной
6. **Практика**: если задача NP-полная, ищем приближённые решения
7. **Главный вопрос**: P = NP? Эквивалентен вопросу: можно ли решить SAT за P?

---
[prev: 03-class-np](./03-class-np.md) | [next: 05-np-hard](./05-np-hard.md)
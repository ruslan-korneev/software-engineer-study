# Арифметика в Bash

## Способы вычислений

В bash есть несколько способов выполнения арифметических операций:

1. `$(( ))` - арифметическая подстановка
2. `let` - встроенная команда
3. `(( ))` - арифметическое выражение
4. `expr` - внешняя команда (устаревший способ)
5. `bc` - калькулятор для чисел с плавающей точкой

## $(( )) - арифметическая подстановка

Самый распространённый способ:

```bash
#!/bin/bash

a=5
b=3

# Базовые операции
echo $((a + b))    # 8 (сложение)
echo $((a - b))    # 2 (вычитание)
echo $((a * b))    # 15 (умножение)
echo $((a / b))    # 1 (целочисленное деление)
echo $((a % b))    # 2 (остаток от деления)
echo $((a ** b))   # 125 (возведение в степень)

# Знак $ внутри не обязателен
echo $((a + b))    # то же, что
echo $(($a + $b))
```

### Присваивание

```bash
result=$((5 + 3))
echo $result  # 8

# Сложные выражения
result=$(( (5 + 3) * 2 - 4 / 2 ))
echo $result  # 14
```

## (( )) - арифметическое выражение

Для вычислений без вывода результата:

```bash
#!/bin/bash

x=5

# Инкремент/декремент
((x++))
echo $x  # 6

((x--))
echo $x  # 5

((x += 10))
echo $x  # 15

((x -= 5))
echo $x  # 10

((x *= 2))
echo $x  # 20

((x /= 4))
echo $x  # 5
```

### В условиях

```bash
#!/bin/bash

a=10
b=5

# (( )) возвращает 0 (true) если результат не равен 0
if ((a > b)); then
    echo "$a больше $b"
fi

if ((a % 2 == 0)); then
    echo "$a чётное"
fi

# Тернарный оператор
((result = a > b ? a : b))
echo "Максимум: $result"
```

## let - команда

```bash
#!/bin/bash

let x=5+3
echo $x  # 8

let "x = 10 * 2"
echo $x  # 20

let x++ y=5
echo "$x $y"  # 21 5
```

## Операторы сравнения (в (( )))

| Оператор | Описание |
|----------|----------|
| `<` | Меньше |
| `>` | Больше |
| `<=` | Меньше или равно |
| `>=` | Больше или равно |
| `==` | Равно |
| `!=` | Не равно |

```bash
#!/bin/bash

a=10
b=5

((a > b)) && echo "a больше b"
((a == b)) && echo "a равно b"
((a != b)) && echo "a не равно b"
```

## Битовые операции

```bash
#!/bin/bash

a=5   # 0101 в двоичной
b=3   # 0011 в двоичной

echo $((a & b))   # 1 (AND: 0001)
echo $((a | b))   # 7 (OR: 0111)
echo $((a ^ b))   # 6 (XOR: 0110)
echo $((~a))      # -6 (NOT)
echo $((a << 1))  # 10 (сдвиг влево)
echo $((a >> 1))  # 2 (сдвиг вправо)
```

## Системы счисления

```bash
#!/bin/bash

# Запись чисел
dec=42          # Десятичное
oct=052         # Восьмеричное (начинается с 0)
hex=0x2A        # Шестнадцатеричное
bin=2#101010    # Двоичное (base#number)

echo $dec $oct $hex $bin  # 42 42 42 42

# Конвертация
echo $((16#FF))    # 255 (hex в dec)
echo $((2#1111))   # 15 (bin в dec)
echo $((8#77))     # 63 (oct в dec)

# Вывод в разных системах
printf "%d %o %x\n" 255 255 255  # 255 377 ff
```

## Генерация случайных чисел

```bash
#!/bin/bash

# $RANDOM - случайное число 0-32767
echo $RANDOM

# Диапазон [0, N)
N=100
echo $((RANDOM % N))

# Диапазон [MIN, MAX]
MIN=10
MAX=50
echo $((RANDOM % (MAX - MIN + 1) + MIN))
```

## Практические примеры

### Калькулятор

```bash
#!/bin/bash

calculator() {
    local a=$1
    local op=$2
    local b=$3

    case $op in
        +) echo $((a + b)) ;;
        -) echo $((a - b)) ;;
        '*') echo $((a * b)) ;;
        /) [[ $b -ne 0 ]] && echo $((a / b)) || echo "Деление на ноль!" ;;
        %) [[ $b -ne 0 ]] && echo $((a % b)) || echo "Деление на ноль!" ;;
        **) echo $((a ** b)) ;;
        *) echo "Неизвестная операция" ;;
    esac
}

calculator 10 + 5   # 15
calculator 10 '*' 5 # 50
calculator 2 '**' 8 # 256
```

### Факториал

```bash
#!/bin/bash

factorial() {
    local n=$1
    local result=1

    for ((i = 2; i <= n; i++)); do
        ((result *= i))
    done

    echo $result
}

factorial 5  # 120
```

### Проверка чётности

```bash
#!/bin/bash

is_even() {
    ((($1 % 2) == 0))
}

is_odd() {
    ((($1 % 2) != 0))
}

for i in {1..10}; do
    if is_even $i; then
        echo "$i чётное"
    else
        echo "$i нечётное"
    fi
done
```

### Сумма чисел

```bash
#!/bin/bash

sum=0
for num in "$@"; do
    ((sum += num))
done
echo "Сумма: $sum"

# Запуск: ./sum.sh 1 2 3 4 5
# Вывод: Сумма: 15
```

### Конвертация размеров

```bash
#!/bin/bash

bytes_to_human() {
    local bytes=$1
    local units=("B" "KB" "MB" "GB" "TB")
    local unit=0

    while ((bytes >= 1024 && unit < 4)); do
        bytes=$((bytes / 1024))
        ((unit++))
    done

    echo "$bytes ${units[$unit]}"
}

bytes_to_human 1073741824  # 1 GB
bytes_to_human 1500000     # 1 MB
```

## Ограничения целочисленной арифметики

```bash
#!/bin/bash

# Максимальное значение зависит от платформы
# 64-bit: -9223372036854775808 до 9223372036854775807

# Переполнение
echo $((9223372036854775807 + 1))  # -9223372036854775808

# Для больших чисел используйте bc
echo "9999999999999999999 * 9999999999999999999" | bc
```

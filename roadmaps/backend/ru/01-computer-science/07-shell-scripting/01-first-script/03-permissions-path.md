# Права доступа и PATH

[prev: 02-script-format](./02-script-format.md) | [next: 04-formatting-tips](./04-formatting-tips.md)

---
## Права на выполнение

Чтобы запустить скрипт напрямую (не через интерпретатор), файл должен иметь право на выполнение (execute permission).

### Просмотр прав

```bash
ls -l script.sh
# -rw-r--r-- 1 user group 256 Jan 15 10:00 script.sh
#  ^  ^  ^
#  |  |  |
#  |  |  +-- права для остальных (r-- = только чтение)
#  |  +----- права для группы (r-- = только чтение)
#  +-------- права владельца (rw- = чтение и запись)
```

### Добавление права на выполнение

```bash
# Добавить право выполнения для владельца
chmod u+x script.sh

# Добавить для всех
chmod +x script.sh

# Или числовой формат
chmod 755 script.sh  # rwxr-xr-x
chmod 700 script.sh  # rwx------ (только владелец)
```

### Числовой формат прав

| Число | Права | Описание |
|-------|-------|----------|
| 7 | rwx | Чтение, запись, выполнение |
| 6 | rw- | Чтение и запись |
| 5 | r-x | Чтение и выполнение |
| 4 | r-- | Только чтение |
| 0 | --- | Нет прав |

Типичные комбинации:
- `755` - владелец всё, остальные читают и выполняют
- `700` - только владелец
- `644` - владелец читает/пишет, остальные только читают

## Способы запуска скрипта

### 1. Прямой запуск (требует права выполнения)

```bash
# Если скрипт в текущей директории
./script.sh

# Полный путь
/home/user/scripts/script.sh

# Если скрипт в PATH
script.sh
```

### 2. Через интерпретатор (не требует права выполнения)

```bash
bash script.sh
sh script.sh
```

Этот способ:
- Игнорирует shebang (используется указанный интерпретатор)
- Не требует права на выполнение
- Полезен для тестирования

### 3. Команда source (выполнение в текущем shell)

```bash
source script.sh
# или эквивалентно
. script.sh
```

Отличие от обычного запуска:
- Скрипт выполняется в текущем процессе shell
- Все переменные и функции становятся доступны в текущем shell
- Используется для загрузки конфигурации (`.bashrc`, `.profile`)

```bash
# Пример: скрипт устанавливает переменную
# set_env.sh:
export MY_VAR="Hello"

# Обычный запуск - переменная не видна после:
./set_env.sh
echo $MY_VAR  # пусто

# Source - переменная доступна:
source set_env.sh
echo $MY_VAR  # Hello
```

## Переменная PATH

### Что такое PATH

`PATH` - это переменная окружения, содержащая список директорий, где shell ищет исполняемые файлы:

```bash
echo $PATH
# /usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin

# Директории разделены двоеточием (:)
```

### Как shell находит команды

Когда вы вводите команду (например, `ls`), shell:
1. Проверяет, не является ли это встроенной командой
2. Ищет исполняемый файл в каждой директории из PATH по порядку
3. Выполняет первый найденный файл

```bash
# Узнать, какой файл выполняется
which ls
# /bin/ls

type ls
# ls is /bin/ls
```

### Добавление своей директории в PATH

```bash
# Временно (только для текущей сессии)
export PATH="$PATH:/home/user/scripts"

# Постоянно (добавить в ~/.bashrc или ~/.profile)
echo 'export PATH="$PATH:$HOME/scripts"' >> ~/.bashrc

# Применить изменения
source ~/.bashrc
```

### Порядок поиска важен

```bash
# PATH ищет слева направо
export PATH="/my/scripts:$PATH"  # Мои скрипты будут найдены первыми
export PATH="$PATH:/my/scripts"  # Системные команды имеют приоритет
```

## Организация скриптов

### Личная директория для скриптов

Рекомендуемые варианты:

```bash
~/bin/           # Классический вариант
~/.local/bin/    # Современный стандарт (XDG)
~/scripts/       # Явное название
```

### Создание и настройка

```bash
# Создать директорию
mkdir -p ~/bin

# Добавить в PATH (в ~/.bashrc)
export PATH="$HOME/bin:$PATH"

# Создать скрипт
cat > ~/bin/hello << 'EOF'
#!/bin/bash
echo "Привет!"
EOF

# Сделать исполняемым
chmod +x ~/bin/hello

# Теперь можно вызывать откуда угодно
hello
```

## Безопасность

### Не добавляйте текущую директорию в PATH

```bash
# ПЛОХО - уязвимость безопасности!
export PATH=".:$PATH"
```

Злоумышленник может создать вредоносный скрипт `ls` в директории, и он выполнится вместо системной команды.

### Используйте явный путь для скриптов в текущей директории

```bash
./script.sh  # Правильно
script.sh    # Может выполнить не тот скрипт
```

### Проверяйте содержимое перед запуском

```bash
# Посмотреть содержимое скрипта
cat script.sh
less script.sh
```

---

[prev: 02-script-format](./02-script-format.md) | [next: 04-formatting-tips](./04-formatting-tips.md)

# Переменные окружения (Environment Variables)

[prev: 05-shutdown](../../04-shell-basics/10-processes/05-shutdown.md) | [next: 02-startup-files](./02-startup-files.md)

---
## Что такое переменные окружения?

**Переменные окружения** (environment variables) — это именованные значения, которые хранят настройки для программ и системы. Они представляют собой пары "имя=значение" и доступны всем процессам в системе.

Переменные окружения выполняют важную роль:
- Хранят пути к исполняемым файлам
- Содержат информацию о пользователе и системе
- Настраивают поведение программ
- Передают конфигурацию между процессами

## Просмотр переменных окружения

### Команда `printenv`

Выводит все переменные окружения или значение конкретной переменной:

```bash
# Показать все переменные окружения
printenv

# Показать значение конкретной переменной
printenv HOME
# /Users/username

printenv PATH
# /usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin
```

### Команда `env`

Похожа на `printenv`, но также может запускать программы с изменённым окружением:

```bash
# Показать все переменные
env

# Запустить команду с дополнительной переменной
env MY_VAR=hello bash -c 'echo $MY_VAR'
# hello
```

### Команда `set`

Показывает как переменные окружения, так и переменные оболочки:

```bash
# Показать все переменные (вывод очень большой)
set

# Лучше использовать с less
set | less
```

### Обращение к переменной через `$`

```bash
# Вывести значение переменной
echo $HOME
# /Users/username

echo $USER
# username

# Использовать в командах
cd $HOME
ls $HOME/Documents
```

## Основные переменные окружения

### PATH — пути поиска программ

Самая важная переменная. Содержит список директорий, где shell ищет исполняемые файлы:

```bash
echo $PATH
# /usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin

# Директории разделены двоеточием (:)
# Shell ищет команды в этих папках слева направо
```

Когда вы вводите команду (например, `ls`), shell:
1. Проверяет `/usr/local/bin/ls`
2. Если не найдено, проверяет `/usr/bin/ls`
3. И так далее по списку PATH

### HOME — домашняя директория

```bash
echo $HOME
# /Users/username (macOS)
# /home/username (Linux)

# Тильда (~) — сокращение для $HOME
cd ~
cd $HOME
# Эти команды эквивалентны
```

### USER и LOGNAME — имя пользователя

```bash
echo $USER
# username

echo $LOGNAME
# username
```

### SHELL — текущая оболочка

```bash
echo $SHELL
# /bin/bash или /bin/zsh
```

### PWD — текущая директория

```bash
echo $PWD
# /Users/username/projects

cd /tmp
echo $PWD
# /tmp
```

### OLDPWD — предыдущая директория

```bash
cd /tmp
cd /var
echo $OLDPWD
# /tmp

# cd - использует OLDPWD
cd -
# переходит в /tmp
```

### LANG и LC_* — настройки локали

```bash
echo $LANG
# en_US.UTF-8 или ru_RU.UTF-8

# LC_ALL переопределяет все настройки локали
echo $LC_ALL
```

### TERM — тип терминала

```bash
echo $TERM
# xterm-256color или screen
```

### EDITOR и VISUAL — редактор по умолчанию

```bash
echo $EDITOR
# vim или nano

# VISUAL используется для полноэкранных редакторов
echo $VISUAL
# vim
```

### PS1 — формат приглашения командной строки

```bash
echo $PS1
# \u@\h:\w\$
# Отображается как: username@hostname:~/projects$
```

## Shell-переменные vs Переменные окружения

Важно понимать разницу:

| Shell-переменные | Переменные окружения |
|------------------|----------------------|
| Видны только в текущем shell | Наследуются дочерними процессами |
| Создаются просто: `VAR=value` | Создаются через `export VAR=value` |
| Не передаются программам | Доступны запущенным программам |

```bash
# Shell-переменная (локальная)
MY_VAR="hello"
echo $MY_VAR  # hello
bash -c 'echo $MY_VAR'  # (пусто — не видна в дочернем процессе)

# Переменная окружения (экспортированная)
export MY_VAR="hello"
bash -c 'echo $MY_VAR'  # hello (видна в дочернем процессе)
```

## Специальные переменные оболочки

```bash
# $? — код возврата последней команды
ls /existing/path
echo $?  # 0 (успех)

ls /nonexistent
echo $?  # 1 или 2 (ошибка)

# $$ — PID текущего shell
echo $$
# 12345

# $! — PID последнего фонового процесса
sleep 100 &
echo $!
# 12346

# $0 — имя скрипта или shell
echo $0
# bash или ./script.sh

# $# — количество аргументов (в скриптах)
# $@ — все аргументы (в скриптах)
# $1, $2, ... — отдельные аргументы (в скриптах)
```

## Практические примеры

### Проверка существования переменной

```bash
# Проверить, установлена ли переменная
if [ -z "$MY_VAR" ]; then
    echo "MY_VAR не установлена"
else
    echo "MY_VAR = $MY_VAR"
fi

# Использовать значение по умолчанию
echo ${MY_VAR:-"значение по умолчанию"}
```

### Использование переменных в путях

```bash
# Создать структуру папок
PROJECT_DIR="$HOME/projects/myapp"
mkdir -p "$PROJECT_DIR"/{src,tests,docs}

# Использовать в скриптах
CONFIG_FILE="$HOME/.config/myapp/settings.conf"
if [ -f "$CONFIG_FILE" ]; then
    source "$CONFIG_FILE"
fi
```

## Резюме

- Переменные окружения — пары "имя=значение" для настройки системы
- `printenv`, `env`, `set` — команды для просмотра переменных
- PATH определяет, где искать исполняемые файлы
- HOME, USER, SHELL — базовые переменные о пользователе
- Shell-переменные локальны, переменные окружения наследуются
- Используйте `$VAR` для обращения к значению переменной

---

[prev: 05-shutdown](../../04-shell-basics/10-processes/05-shutdown.md) | [next: 02-startup-files](./02-startup-files.md)

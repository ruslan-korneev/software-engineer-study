# Работа с несколькими файлами в Vi (Multiple Files)

## Открытие нескольких файлов

### При запуске

```bash
# Открыть несколько файлов в буферах
vim file1.txt file2.txt file3.txt

# Открыть файлы в горизонтальных окнах
vim -o file1.txt file2.txt

# Открыть файлы в вертикальных окнах
vim -O file1.txt file2.txt

# Открыть файлы во вкладках
vim -p file1.txt file2.txt
```

### Внутри редактора

```bash
:e filename      # открыть файл (edit)
:e!              # перезагрузить текущий файл (отменить изменения)
:e .             # открыть файловый браузер текущей директории
```

## Работа с буферами

**Буфер** — это файл, загруженный в память Vi. Даже если он не виден на экране, он остаётся в памяти.

### Команды для буферов

```bash
:ls              # список всех буферов
:buffers         # то же самое
:files           # то же самое

# Переключение между буферами
:b N             # перейти к буферу N (номер из :ls)
:b filename      # перейти к буферу по имени
:bn              # следующий буфер (buffer next)
:bp              # предыдущий буфер (buffer previous)
:bf              # первый буфер (buffer first)
:bl              # последний буфер (buffer last)
:b#              # предыдущий редактируемый буфер
Ctrl+^           # быстрое переключение на предыдущий буфер

# Управление буферами
:bd              # закрыть буфер (buffer delete)
:bd N            # закрыть буфер N
:bd!             # закрыть без сохранения
:%bd             # закрыть все буферы
```

### Пример работы с буферами

```bash
# Открыть файл
:e file1.txt

# Открыть ещё один
:e file2.txt

# Посмотреть список
:ls
#   1 #    "file1.txt"                line 1
#   2 %a   "file2.txt"                line 1

# Символы статуса:
# % — текущий буфер
# # — альтернативный (предыдущий)
# a — активный (видимый в окне)
# h — скрытый
# + — изменённый

:b1              # вернуться к file1.txt
:bn              # следующий (file2.txt)
Ctrl+^           # быстро назад к file1.txt
```

## Работа с окнами (Windows)

**Окно** — это viewport (область просмотра) буфера. Один буфер может быть показан в нескольких окнах.

### Разделение экрана

```bash
# Горизонтальное разделение
:sp              # разделить с тем же файлом (split)
:sp filename     # разделить и открыть файл
Ctrl+w s         # разделить (split)

# Вертикальное разделение
:vsp             # вертикальное разделение (vsplit)
:vsp filename    # разделить и открыть файл
Ctrl+w v         # вертикальное разделение

# Новое окно с пустым буфером
:new             # горизонтально
:vnew            # вертикально
```

### Навигация между окнами

```bash
Ctrl+w w         # перейти к следующему окну (по кругу)
Ctrl+w h         # перейти к окну слева
Ctrl+w j         # перейти к окну снизу
Ctrl+w k         # перейти к окну сверху
Ctrl+w l         # перейти к окну справа

Ctrl+w p         # перейти к предыдущему окну
Ctrl+w t         # перейти к верхнему левому окну
Ctrl+w b         # перейти к нижнему правому окну
```

### Управление размером окон

```bash
Ctrl+w =         # сделать все окна равного размера
Ctrl+w _         # максимизировать высоту текущего окна
Ctrl+w |         # максимизировать ширину текущего окна
Ctrl+w +         # увеличить высоту
Ctrl+w -         # уменьшить высоту
Ctrl+w >         # увеличить ширину
Ctrl+w <         # уменьшить ширину

:resize N        # установить высоту N строк
:vertical resize N  # установить ширину N столбцов
```

### Перемещение окон

```bash
Ctrl+w r         # повернуть окна вниз/вправо (rotate)
Ctrl+w R         # повернуть окна вверх/влево
Ctrl+w x         # поменять местами с соседним окном

Ctrl+w H         # переместить окно влево (на всю высоту)
Ctrl+w J         # переместить окно вниз (на всю ширину)
Ctrl+w K         # переместить окно вверх (на всю ширину)
Ctrl+w L         # переместить окно вправо (на всю высоту)
```

### Закрытие окон

```bash
:q               # закрыть текущее окно
:close           # то же самое
Ctrl+w c         # закрыть окно
Ctrl+w q         # закрыть окно (quit)

:only            # закрыть все окна кроме текущего
Ctrl+w o         # то же самое

:qa              # закрыть все окна и выйти
:qa!             # выйти без сохранения
```

## Работа со вкладками (Tabs)

**Вкладка** — это набор окон. Каждая вкладка может содержать несколько окон.

### Создание вкладок

```bash
:tabnew          # новая пустая вкладка
:tabnew filename # новая вкладка с файлом
:tabe filename   # то же самое (tabedit)
```

### Навигация по вкладкам

```bash
gt               # следующая вкладка
gT               # предыдущая вкладка
Ngt              # перейти к вкладке N

:tabn            # следующая вкладка
:tabp            # предыдущая вкладка
:tabfirst        # первая вкладка
:tablast         # последняя вкладка
```

### Управление вкладками

```bash
:tabs            # список вкладок
:tabclose        # закрыть текущую вкладку
:tabonly         # закрыть все вкладки кроме текущей
:tabm N          # переместить вкладку на позицию N
:tabm +1         # переместить вкладку вправо
:tabm -1         # переместить вкладку влево
```

## Сохранение нескольких файлов

```bash
:w               # сохранить текущий файл
:wa              # сохранить все изменённые буферы (write all)
:wq              # сохранить и закрыть окно
:wqa             # сохранить все и выйти
:xa              # то же что :wqa
```

## Сравнение файлов (diff)

```bash
# Запуск в режиме diff
vimdiff file1 file2
vim -d file1 file2

# Внутри vim
:diffsplit filename    # открыть файл для сравнения
:diffthis              # включить diff для текущего окна
:diffoff               # выключить diff
:diffoff!              # выключить diff для всех окон
:diffupdate            # обновить diff после изменений
```

### Навигация по различиям

```bash
]c               # следующее изменение
[c               # предыдущее изменение
```

### Применение изменений

```bash
:diffget         # получить изменение из другого файла
do               # то же (diff obtain)
:diffput         # отправить изменение в другой файл
dp               # то же (diff put)
```

## Практические примеры

### Пример 1: Редактирование конфига с просмотром оригинала

```bash
vim config.yaml

# Внутри vim:
:vsp config.yaml.bak    # открыть бэкап для сравнения
Ctrl+w l                # перейти к редактируемому файлу
```

### Пример 2: Одновременное редактирование HTML и CSS

```bash
vim -O index.html style.css

# Ctrl+w l/h для переключения
# Или :bn/:bp для буферов
```

### Пример 3: Копирование между файлами

```bash
# Файл 1: скопировать функцию
yip              # копировать абзац (функцию)

# Переключиться на другой файл
:bn              # или Ctrl+^

# Вставить
p
```

### Пример 4: Работа с проектом

```bash
# Открыть несколько файлов проекта
vim -p src/main.py src/utils.py tests/test_main.py

# Переключаться: gt, gT
# Или использовать :ls и :b <имя>
```

## Полезные настройки

```vim
" В ~/.vimrc

" Разрешить скрытые буферы (не сохраняя)
set hidden

" Показывать вкладки сверху
set showtabline=2

" Удобные сочетания для окон
nnoremap <C-h> <C-w>h
nnoremap <C-j> <C-w>j
nnoremap <C-k> <C-w>k
nnoremap <C-l> <C-w>l
```

## Резюме

| Концепция | Описание |
|-----------|----------|
| Буфер | Файл в памяти |
| Окно | Область просмотра буфера |
| Вкладка | Набор окон |

| Действие | Команда |
|----------|---------|
| Список буферов | :ls |
| Следующий буфер | :bn |
| Предыдущий буфер | :bp |
| Горизонтальное разделение | :sp или Ctrl+w s |
| Вертикальное разделение | :vsp или Ctrl+w v |
| Переключение окон | Ctrl+w w или Ctrl+w h/j/k/l |
| Закрыть окно | :q или Ctrl+w c |
| Новая вкладка | :tabnew |
| Следующая вкладка | gt |
| Сохранить все | :wa |

- Буферы позволяют держать много файлов в памяти
- Окна позволяют видеть несколько буферов одновременно
- Вкладки группируют окна для разных задач
- Ctrl+w — префикс для команд работы с окнами

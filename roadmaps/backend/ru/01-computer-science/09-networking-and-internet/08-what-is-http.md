# Что такое HTTP?

[prev: 07-what-is-domain-name](./07-what-is-domain-name.md) | [next: 09-what-is-hosting](./09-what-is-hosting.md)

---
**HTTP (HyperText Transfer Protocol)** — протокол передачи данных в вебе. Это "язык", на котором браузер общается с сервером.

## Как работает?

```
Браузер                              Сервер
   |                                    |
   |  -- GET /index.html HTTP/1.1 -->   |
   |                                    |
   |  <-- HTTP/1.1 200 OK + HTML --     |
   |                                    |
```

## Структура HTTP-запроса

```http
GET /api/users HTTP/1.1
Host: example.com
User-Agent: Mozilla/5.0
Accept: application/json
```

- **Метод** (GET) — что хотим сделать
- **Путь** (/api/users) — какой ресурс запрашиваем
- **Версия** (HTTP/1.1)
- **Заголовки** (Host, User-Agent...) — метаданные запроса

## Структура HTTP-ответа

```http
HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 42

{"id": 1, "name": "Ruslan"}
```

- **Статус-код** (200) — результат выполнения
- **Заголовки** — метаданные ответа
- **Тело** — сами данные (HTML, JSON, файл и т.д.)

## HTTP-методы

| Метод | Назначение | Пример использования |
|-------|------------|---------------------|
| **GET** | Получить данные | Загрузить страницу, получить список |
| **POST** | Создать ресурс | Отправить форму, создать пользователя |
| **PUT** | Заменить ресурс полностью | Обновить весь профиль |
| **PATCH** | Частично обновить | Изменить только email |
| **DELETE** | Удалить ресурс | Удалить пост |
| **HEAD** | Получить только заголовки | Проверить существование ресурса |
| **OPTIONS** | Узнать доступные методы | Preflight-запросы CORS |

## Статус-коды

| Диапазон | Значение | Примеры |
|----------|----------|---------|
| **1xx** | Информационные | 100 Continue, 101 Switching Protocols |
| **2xx** | Успех | 200 OK, 201 Created, 204 No Content |
| **3xx** | Перенаправление | 301 Moved Permanently, 302 Found, 304 Not Modified |
| **4xx** | Ошибка клиента | 400 Bad Request, 401 Unauthorized, 403 Forbidden, 404 Not Found |
| **5xx** | Ошибка сервера | 500 Internal Server Error, 502 Bad Gateway, 503 Service Unavailable |

### Самые частые коды

- **200** — всё ок
- **201** — ресурс создан
- **400** — неверный запрос (ошибка валидации)
- **401** — не авторизован (нужен логин)
- **403** — запрещено (нет прав)
- **404** — не найдено
- **500** — ошибка на сервере

## HTTP vs HTTPS

| HTTP | HTTPS |
|------|-------|
| Данные открытым текстом | Шифрование через TLS/SSL |
| Порт 80 | Порт 443 |
| Небезопасно | Безопасно |
| Можно перехватить данные | Данные зашифрованы |

**HTTPS** = HTTP + TLS-шифрование. Сейчас это стандарт для всех сайтов.

## Версии HTTP

| Версия | Год | Особенности |
|--------|-----|-------------|
| **HTTP/1.0** | 1996 | Одно соединение = один запрос |
| **HTTP/1.1** | 1997 | Keep-alive, chunked transfer, Host header |
| **HTTP/2** | 2015 | Мультиплексирование, сжатие заголовков, бинарный формат, server push |
| **HTTP/3** | 2022 | На основе QUIC (UDP вместо TCP), ещё быстрее |

## Важные заголовки

### Запрос
- `Host` — домен сервера (обязателен в HTTP/1.1)
- `User-Agent` — информация о клиенте
- `Accept` — какой формат ответа ожидаем
- `Authorization` — данные для авторизации
- `Cookie` — cookies для сессии
- `Content-Type` — тип тела запроса (для POST/PUT)

### Ответ
- `Content-Type` — тип данных (text/html, application/json)
- `Content-Length` — размер тела ответа
- `Set-Cookie` — установить cookie
- `Cache-Control` — правила кэширования
- `Location` — куда перенаправить (для 3xx)

## Ключевые особенности HTTP

1. **Stateless (без состояния)** — сервер не помнит предыдущие запросы. Для сохранения состояния используют cookies, сессии, JWT-токены.

2. **Текстовый протокол** (HTTP/1.x) — запросы/ответы можно читать как текст.

3. **Request-Response** — клиент всегда инициирует общение, сервер только отвечает.

4. **Клиент-сервер** — чёткое разделение ролей.

---

## Q&A

### В чём выражается мультиплексирование в HTTP/2?

**Проблема HTTP/1.1:** запросы идут последовательно в одном соединении. Если ответ медленный — все остальные ждут (**Head-of-Line Blocking**). Обходной путь — открывать 6-8 параллельных соединений, но это затратно.

**Решение HTTP/2:** мультиплексирование — много запросов/ответов идут **одновременно** в одном соединении.

HTTP/2 разбивает данные на **фреймы** (frames), каждый с уникальным **Stream ID**:

```
┌─────────────────────────────┐
│  Frame: Stream ID=1, DATA   │  ← часть ответа для запроса 1
├─────────────────────────────┤
│  Frame: Stream ID=3, DATA   │  ← часть ответа для запроса 3
├─────────────────────────────┤
│  Frame: Stream ID=1, DATA   │  ← ещё часть для запроса 1
├─────────────────────────────┤
│  Frame: Stream ID=2, DATA   │  ← часть ответа для запроса 2
└─────────────────────────────┘
```

Фреймы перемешаны, но клиент собирает их обратно по Stream ID.

**Сравнение:**

| HTTP/1.1 | HTTP/2 |
|----------|--------|
| 6-8 TCP-соединений | 1 соединение |
| Блокировка очереди | Параллельные потоки |
| Повторный handshake для каждого | Один handshake |
| Больше памяти/CPU | Эффективнее |

### Как работает шифрование TLS/SSL?

**SSL (Secure Sockets Layer)** — старый протокол (устарел, небезопасен).
**TLS (Transport Layer Security)** — современная замена. Сейчас используют TLS 1.2 и TLS 1.3.

**Что даёт TLS:**
- **Шифрование** — данные нельзя прочитать при перехвате
- **Аутентификация** — уверенность, что сервер настоящий
- **Целостность** — данные не изменены по пути

**TLS Handshake (упрощённо):**

```
Клиент                                    Сервер
   |  1. ClientHello (версия TLS, шифры)     |
   | ─────────────────────────────────────>  |
   |  2. ServerHello + Сертификат            |
   | <─────────────────────────────────────  |
   |  3. Проверка сертификата,               |
   |     генерация сессионного ключа         |
   | ─────────────────────────────────────>  |
   |  4. Шифрованный канал установлен        |
   | <────────────────────────────────────>  |
```

**Два типа шифрования:**

| Тип | Алгоритмы | Использование |
|-----|-----------|---------------|
| **Асимметричное** | RSA, ECDSA | Только handshake (медленное) |
| **Симметричное** | AES, ChaCha20 | Данные (быстрое) |

Асимметричное: публичный ключ шифрует, приватный расшифровывает.
Симметричное: один ключ для шифрования и расшифровки.

**Сертификаты:**

Сертификат — "паспорт" сайта, подтверждающий подлинность. Содержит:
- Домен владельца
- Публичный ключ
- Срок действия
- Подпись CA (Certificate Authority)

CA — организации, выдающие сертификаты: Let's Encrypt (бесплатный), DigiCert, Comodo.

**TLS 1.2 vs TLS 1.3:**

| TLS 1.2 | TLS 1.3 |
|---------|---------|
| 2 round-trips для handshake | 1 round-trip |
| Поддержка старых шифров | Только современные |
| ~100мс на handshake | ~50мс |

**Что видит злоумышленник при перехвате HTTPS:**
```
0x17 0x03 0x03 0x00 0x1F 0xA3 0x8B 0x2C...
(нечитаемый мусор вместо данных)
```

---

[prev: 07-what-is-domain-name](./07-what-is-domain-name.md) | [next: 09-what-is-hosting](./09-what-is-hosting.md)

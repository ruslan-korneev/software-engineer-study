# tr - трансляция и удаление символов

[prev: 03-diff-patch](./03-diff-patch.md) | [next: 05-sed](./05-sed.md)

---
## Что такое tr?

**tr** (translate) - утилита для замены, удаления и сжатия символов. Работает только со stdin (не принимает файлы как аргументы).

## Базовый синтаксис

```bash
tr [опции] SET1 [SET2]
```

- **SET1** - символы для поиска
- **SET2** - символы для замены

## Замена символов

### Простая замена

```bash
# Заменить a на b
echo "apple" | tr 'a' 'b'
# bpple

# Заменить несколько символов
echo "hello" | tr 'aeiou' '12345'
# h2ll4

# Символы заменяются позиционно:
# a -> 1
# e -> 2
# i -> 3
# o -> 4
# u -> 5
```

### Регистр

```bash
# Нижний в верхний регистр
echo "hello world" | tr 'a-z' 'A-Z'
# HELLO WORLD

# Или с POSIX классами
echo "hello world" | tr '[:lower:]' '[:upper:]'
# HELLO WORLD

# Верхний в нижний
echo "HELLO WORLD" | tr 'A-Z' 'a-z'
echo "HELLO WORLD" | tr '[:upper:]' '[:lower:]'
```

### Диапазоны

```bash
# Диапазон символов
echo "abc123xyz" | tr 'a-z' 'A-Z'
# ABC123XYZ

echo "ABC" | tr 'A-Z' 'a-z'
# abc

# Цифры
echo "12345" | tr '0-9' 'abcdefghij'
# bcdef

# ROT13 шифрование
echo "hello" | tr 'a-zA-Z' 'n-za-mN-ZA-M'
# uryyb
echo "uryyb" | tr 'a-zA-Z' 'n-za-mN-ZA-M'
# hello
```

## Удаление символов (-d)

```bash
# Удалить символы из SET1
echo "hello 123 world" | tr -d '0-9'
# hello  world

# Удалить пробелы
echo "hello world" | tr -d ' '
# helloworld

# Удалить все кроме цифр
echo "phone: 123-456-7890" | tr -d -c '0-9\n'
# 1234567890

# Удалить переносы строк
cat file.txt | tr -d '\n'

# Удалить непечатные символы
tr -d '\000-\011\013\014\016-\037' < dirty.txt > clean.txt
```

## Сжатие повторов (-s)

```bash
# Заменить повторяющиеся символы на один
echo "hellooooo" | tr -s 'o'
# hello

# Сжать пробелы
echo "hello     world" | tr -s ' '
# hello world

# Сжать все пробельные символы
echo -e "hello\t\t\tworld" | tr -s '[:space:]'
# hello world

# Множественные пустые строки в одну
cat file.txt | tr -s '\n'
```

## Комплементирование (-c)

Опция `-c` инвертирует SET1 (всё кроме указанных символов):

```bash
# Оставить только буквы, заменить остальное на пробел
echo "hello123world" | tr -c 'a-zA-Z' ' '
# hello   world

# Оставить только цифры
echo "phone: 123-456" | tr -c '0-9' ' '
#        123 456

# Удалить всё кроме букв и пробелов
echo "hello123 world456" | tr -cd 'a-zA-Z '
# hello world

# Удалить всё кроме цифр и переноса
echo "order #123: $45.67" | tr -cd '0-9.\n'
# 12345.67
```

## Специальные символы

### Escape-последовательности

```bash
\n  - новая строка
\r  - возврат каретки
\t  - табуляция
\\  - обратный слеш
\NNN - восьмеричный код символа
```

```bash
# Заменить табы на пробелы
cat file.txt | tr '\t' ' '

# Заменить переносы на пробелы
cat file.txt | tr '\n' ' '

# Windows переносы в Unix
tr -d '\r' < windows.txt > unix.txt

# Или
tr '\r\n' '\n' < windows.txt > unix.txt
```

### POSIX классы

```bash
[:alnum:]  - буквы и цифры
[:alpha:]  - буквы
[:digit:]  - цифры
[:lower:]  - строчные буквы
[:upper:]  - заглавные буквы
[:space:]  - пробельные символы
[:punct:]  - пунктуация
[:print:]  - печатные символы
[:cntrl:]  - управляющие символы
```

```bash
# Удалить все цифры
echo "abc123def" | tr -d '[:digit:]'
# abcdef

# Удалить пунктуацию
echo "Hello, World!" | tr -d '[:punct:]'
# Hello World

# Заменить пробельные на пробел
echo -e "hello\tworld\ntest" | tr '[:space:]' ' '
# hello world test
```

## Практические примеры

### Очистка данных

```bash
# Нормализовать пробелы
tr -s '[:space:]' ' ' < file.txt

# Удалить непечатные символы
tr -cd '[:print:]\n' < dirty.txt > clean.txt

# Удалить BOM из UTF-8
sed '1s/^\xEF\xBB\xBF//' file.txt
# или
tail -c +4 file.txt  # если BOM 3 байта
```

### Обработка CSV

```bash
# Заменить разделители
cat file.csv | tr ',' '\t'    # CSV в TSV
cat file.tsv | tr '\t' ','    # TSV в CSV

# Удалить кавычки
cat file.csv | tr -d '"'
```

### Генерация паролей

```bash
# Случайные символы
tr -cd 'a-zA-Z0-9' < /dev/urandom | head -c 16
# dK7mN2xPq9Ls4Wz1

# Только буквы
tr -cd 'a-zA-Z' < /dev/urandom | head -c 12

# Только цифры (PIN)
tr -cd '0-9' < /dev/urandom | head -c 6
```

### Подсчёт символов

```bash
# Количество слов (приблизительно)
tr -s '[:space:]' '\n' < file.txt | wc -l

# Частота букв
tr '[:upper:]' '[:lower:]' < file.txt | tr -cd '[:alpha:]' | \
    fold -w1 | sort | uniq -c | sort -rn
```

### Преобразование формата

```bash
# Столбец в строку
cat list.txt | tr '\n' ','
# item1,item2,item3,

# Строка в столбец
echo "a,b,c,d" | tr ',' '\n'
# a
# b
# c
# d

# Удалить все табы (для Makefile отладки)
cat Makefile | tr -d '\t' > notas.txt
```

### Работа с логами

```bash
# Нормализовать разделители в логе
cat access.log | tr -s ' ' | cut -d' ' -f1,7,9

# Заменить NULL символы
tr '\0' '\n' < binary_log
```

## Ограничения tr

1. **Только stdin** - не принимает файлы как аргументы
   ```bash
   # Неправильно
   tr 'a' 'b' file.txt

   # Правильно
   tr 'a' 'b' < file.txt
   cat file.txt | tr 'a' 'b'
   ```

2. **Однобайтовые символы** - проблемы с UTF-8
   ```bash
   # Может не работать с кириллицей
   echo "привет" | tr 'а-я' 'А-Я'

   # Используйте sed для UTF-8
   echo "привет" | sed 's/./\U&/g'
   ```

3. **Нет регулярных выражений** - только символы и классы

## Альтернативы

### sed для сложных замен

```bash
# sed более мощный
echo "hello" | sed 's/[aeiou]/X/g'
# hXllX

# UTF-8 регистр
echo "привет" | sed 's/.*/\U&/'
# ПРИВЕТ
```

### awk для сложной логики

```bash
# Условная замена
awk '{gsub(/pattern/, "replacement"); print}'
```

## Резюме

| Команда | Описание |
|---------|----------|
| `tr 'a' 'b'` | Заменить a на b |
| `tr 'a-z' 'A-Z'` | В верхний регистр |
| `tr -d 'chars'` | Удалить символы |
| `tr -s 'char'` | Сжать повторы |
| `tr -c 'set' 'X'` | Заменить всё кроме set |
| `tr -cd 'set'` | Оставить только set |
| `tr '\t' ' '` | Табы в пробелы |
| `tr -d '\r'` | Удалить CR (Windows) |

---

[prev: 03-diff-patch](./03-diff-patch.md) | [next: 05-sed](./05-sed.md)

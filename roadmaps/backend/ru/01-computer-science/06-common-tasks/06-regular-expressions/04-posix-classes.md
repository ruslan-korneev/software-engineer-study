# POSIX классы символов

[prev: 03-metacharacters](./03-metacharacters.md) | [next: 05-quantifiers](./05-quantifiers.md)

---
## Что такое POSIX классы?

**POSIX классы** (bracket expressions) - это предопределённые наборы символов, которые работают независимо от локали и кодировки. Они обеспечивают переносимость регулярных выражений между разными системами.

## Синтаксис

POSIX классы используются внутри квадратных скобок:

```bash
[[:class:]]     # соответствует классу
[^[:class:]]    # НЕ соответствует классу
```

## Список POSIX классов

| Класс | Описание | Эквивалент |
|-------|----------|------------|
| `[:alnum:]` | Буквы и цифры | `[a-zA-Z0-9]` |
| `[:alpha:]` | Буквы | `[a-zA-Z]` |
| `[:digit:]` | Цифры | `[0-9]` |
| `[:lower:]` | Строчные буквы | `[a-z]` |
| `[:upper:]` | Заглавные буквы | `[A-Z]` |
| `[:space:]` | Пробельные символы | `[ \t\n\r\f\v]` |
| `[:blank:]` | Пробел и таб | `[ \t]` |
| `[:punct:]` | Знаки пунктуации | Спецсимволы |
| `[:graph:]` | Видимые символы | `[:alnum:]` + `[:punct:]` |
| `[:print:]` | Печатные символы | `[:graph:]` + пробел |
| `[:cntrl:]` | Управляющие символы | Коды 0-31, 127 |
| `[:xdigit:]` | Шестнадцатеричные | `[0-9A-Fa-f]` |

## Примеры использования

### [:alnum:] - буквы и цифры

```bash
# Найти слова из букв и цифр
grep '[[:alnum:]]\+' text.txt

# Строки начинающиеся с буквы или цифры
grep '^[[:alnum:]]' lines.txt

# Только буквенно-цифровые строки
grep '^[[:alnum:]]*$' data.txt
```

### [:alpha:] - только буквы

```bash
# Слова (только буквы)
grep '[[:alpha:]]\+' text.txt

# Строки без цифр
grep '^[[:alpha:][:space:][:punct:]]*$' text.txt
```

### [:digit:] - цифры

```bash
# Найти числа
grep '[[:digit:]]\+' data.txt

# Строки из только цифр
grep '^[[:digit:]]*$' numbers.txt

# Четырёхзначные числа
grep '[[:digit:]]\{4\}' text.txt
```

### [:lower:] и [:upper:]

```bash
# Слова в нижнем регистре
grep '\<[[:lower:]]\+\>' text.txt

# Слова в верхнем регистре (аббревиатуры)
grep '\<[[:upper:]]\{2,\}\>' text.txt

# Начинается с заглавной (имена)
grep '\<[[:upper:]][[:lower:]]*\>' text.txt

# CamelCase
grep '[[:lower:]][[:upper:]]' code.txt
```

### [:space:] и [:blank:]

```bash
# [:space:] - все пробельные символы (пробел, таб, перевод строки)
# Строки с пробелами
grep '[[:space:]]' file.txt

# Пустые или пробельные строки
grep '^[[:space:]]*$' file.txt

# [:blank:] - только пробел и таб
# Строки с отступами
grep '^[[:blank:]]' code.txt

# Удалить начальные/конечные пробелы (с sed)
sed 's/^[[:blank:]]*//; s/[[:blank:]]*$//' file.txt
```

### [:punct:] - пунктуация

```bash
# Строки со знаками препинания
grep '[[:punct:]]' text.txt

# Только буквы и пробелы (без пунктуации)
grep '^[[:alpha:][:space:]]*$' text.txt

# Подсчитать знаки препинания
grep -o '[[:punct:]]' text.txt | wc -l
```

### [:xdigit:] - шестнадцатеричные

```bash
# Найти HEX значения
grep '[[:xdigit:]]\+' data.txt

# MAC-адреса
grep -E '([[:xdigit:]]{2}:){5}[[:xdigit:]]{2}' network.txt

# Цвета в HEX формате
grep -E '#[[:xdigit:]]{6}' styles.css
```

## Комбинирование классов

```bash
# Буквы, цифры и подчёркивание (как \w)
grep '[[:alnum:]_]\+' code.txt

# Буквы и пробелы
grep '[[:alpha:][:space:]]\+' text.txt

# НЕ буквы и НЕ цифры
grep '[^[:alnum:]]' text.txt

# Печатные символы кроме пробелов
grep '[[:graph:]]\+' text.txt
```

## Сравнение с другими форматами

### POSIX vs диапазоны

```bash
# Эти выражения МОГУТ отличаться в разных локалях
[a-z]         # зависит от локали
[[:lower:]]   # всегда корректно

# Пример проблемы с локалью:
# В некоторых локалях [a-z] может включать заглавные буквы!
# LC_COLLATE влияет на порядок символов
```

### POSIX vs PCRE

| POSIX | PCRE | Описание |
|-------|------|----------|
| `[[:digit:]]` | `\d` | Цифры |
| `[[:alpha:]]` | `\p{L}` | Буквы |
| `[[:alnum:]]` | `\w` (частично) | Буквы и цифры |
| `[[:space:]]` | `\s` | Пробельные |
| `[^[:digit:]]` | `\D` | НЕ цифры |
| `[^[:space:]]` | `\S` | НЕ пробельные |

```bash
# PCRE эквиваленты (grep -P)
grep -P '\d+' numbers.txt        # вместо [[:digit:]]+
grep -P '\w+' words.txt          # вместо [[:alnum:]_]+
grep -P '\s+' text.txt           # вместо [[:space:]]+
```

## Практические примеры

### Валидация ввода

```bash
# Только буквы (имя)
grep '^[[:alpha:]]\+$' names.txt

# Буквы и пробелы (полное имя)
grep '^[[:alpha:]][[:alpha:][:space:]]*$' names.txt

# Идентификатор (буквы, цифры, подчёркивание)
grep '^[[:alpha:]_][[:alnum:]_]*$' identifiers.txt

# Целое число
grep '^-\?[[:digit:]]\+$' numbers.txt

# Десятичное число
grep '^-\?[[:digit:]]*\.\?[[:digit:]]\+$' decimals.txt
```

### Очистка данных

```bash
# Удалить непечатные символы
tr -cd '[:print:]' < dirty.txt > clean.txt

# Удалить пробельные символы в начале строк
sed 's/^[[:space:]]*//' file.txt

# Удалить пустые строки
grep -v '^[[:space:]]*$' file.txt

# Нормализовать пробелы
tr -s '[:space:]' ' ' < file.txt
```

### Поиск паттернов

```bash
# Слова начинающиеся с заглавной
grep '\<[[:upper:]][[:lower:]]*\>' text.txt

# Аббревиатуры (2+ заглавных подряд)
grep '[[:upper:]]\{2,\}' text.txt

# Числа с разделителями
grep '[[:digit:]]\{1,3\}\(,[[:digit:]]\{3\}\)*' numbers.txt
```

### Работа с логами

```bash
# Строки с временными метками (HH:MM:SS)
grep '[[:digit:]]\{2\}:[[:digit:]]\{2\}:[[:digit:]]\{2\}' log.txt

# Строки с датой YYYY-MM-DD
grep '[[:digit:]]\{4\}-[[:digit:]]\{2\}-[[:digit:]]\{2\}' log.txt

# Строки с HEX значениями (ошибки, адреса)
grep '0x[[:xdigit:]]\+' log.txt
```

## Локализация

POSIX классы зависят от текущей локали:

```bash
# Проверить текущую локаль
locale

# Использовать C-локаль (ASCII только)
LC_ALL=C grep '[[:alpha:]]' file.txt

# Русские буквы с правильной локалью
LC_ALL=ru_RU.UTF-8 grep '[[:alpha:]]' russian.txt
```

### Проблемы с локалью

```bash
# В русской локали [а-я] может не работать правильно
# Используйте POSIX классы для надёжности

# Или явно указывайте C-локаль
LC_ALL=C grep '[a-zA-Z]' file.txt
```

## Резюме

### Основные классы

| Класс | Что содержит |
|-------|--------------|
| `[:alnum:]` | Буквы + цифры |
| `[:alpha:]` | Буквы |
| `[:digit:]` | Цифры 0-9 |
| `[:lower:]` | Строчные буквы |
| `[:upper:]` | Заглавные буквы |
| `[:space:]` | Все пробельные |
| `[:blank:]` | Пробел + таб |
| `[:punct:]` | Пунктуация |
| `[:xdigit:]` | Hex цифры |

### Шаблоны использования

```bash
# Внутри скобок
grep '[[:digit:]]' file.txt

# С квантификаторами
grep '[[:alpha:]]\+' file.txt

# Отрицание
grep '[^[:digit:]]' file.txt

# Комбинация
grep '[[:alpha:][:digit:]]' file.txt
```

---

[prev: 03-metacharacters](./03-metacharacters.md) | [next: 05-quantifiers](./05-quantifiers.md)

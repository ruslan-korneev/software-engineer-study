# Команда ln

[prev: 05-rm](./05-rm.md) | [next: 01-type-which](../05-working-with-commands/01-type-which.md)

---
## Что такое ln?

**ln** (link) — команда для создания ссылок на файлы и директории. Ссылки позволяют создать несколько имён для одного файла.

## Типы ссылок

- **Жёсткие ссылки** (hard links) — дополнительное имя для того же inode
- **Символические ссылки** (symbolic/soft links) — файл-указатель на путь

## Синтаксис

```bash
ln [опции] цель имя_ссылки
ln [опции] цель... директория
```

## Создание жёстких ссылок

По умолчанию `ln` создаёт жёсткие ссылки:

```bash
$ ln original.txt hardlink.txt
$ ls -li
12345 -rw-r--r-- 2 user group 100 original.txt
12345 -rw-r--r-- 2 user group 100 hardlink.txt
#     одинаковый inode ↑     счётчик ссылок = 2
```

Оба имени указывают на одни и те же данные. Изменение одного отразится на другом:
```bash
$ echo "new content" >> hardlink.txt
$ cat original.txt
new content
```

## Создание символических ссылок

Опция `-s` создаёт символическую ссылку:

```bash
$ ln -s original.txt symlink.txt
$ ls -l
-rw-r--r-- 1 user group 100 original.txt
lrwxrwxrwx 1 user group  12 symlink.txt -> original.txt
```

Символ `l` в начале и стрелка `->` указывают на символическую ссылку.

## Основные опции

### -s (symbolic) — символическая ссылка
```bash
$ ln -s target linkname
```

### -f (force) — перезаписать существующую ссылку
```bash
$ ln -sf newtarget existinglink
```

### -n (no-dereference) — не разыменовывать
```bash
$ ln -sfn newtarget symlink    # заменить ссылку, не заходя внутрь
```

### -v (verbose) — подробный вывод
```bash
$ ln -sv file.txt link.txt
'link.txt' -> 'file.txt'
```

### -b (backup) — создать резервную копию
```bash
$ ln -sb file.txt existing-link.txt
$ ls
existing-link.txt  existing-link.txt~
```

### -r (relative) — относительный путь (GNU ln)
```bash
$ ln -sr /long/path/to/file.txt link.txt
# Создаст относительную ссылку
```

## Практические примеры

### Ссылка на конфигурацию
```bash
$ ln -s ~/.dotfiles/bashrc ~/.bashrc
$ ln -s /etc/nginx/sites-available/mysite /etc/nginx/sites-enabled/
```

### Быстрый доступ к директории
```bash
$ ln -s /very/long/path/to/project ~/project
$ cd ~/project    # быстро!
```

### Версионирование программ
```bash
$ ls -l /usr/bin/python*
python -> python3.10
python3 -> python3.10
python3.10

# Переключение версии
$ ln -sf python3.11 /usr/bin/python3
```

### Ссылка на библиотеку
```bash
$ ln -s libfoo.so.1.2.3 libfoo.so.1
$ ln -s libfoo.so.1 libfoo.so
```

### Создание нескольких ссылок
```bash
$ ln -s /usr/share/doc/* ~/docs/
# Ссылки на все документы
```

## Абсолютные vs относительные пути

### Абсолютный путь
```bash
$ ln -s /home/user/file.txt link.txt
$ cat link.txt
# Всегда смотрит на /home/user/file.txt
```

### Относительный путь
```bash
$ ln -s ../shared/file.txt link.txt
# Путь относителен к расположению ссылки
```

Рекомендуется использовать **абсолютные пути** для надёжности:
```bash
$ ln -s "$(realpath file.txt)" link.txt
```

## Проверка и управление ссылками

### Показать цель ссылки
```bash
$ readlink symlink.txt
original.txt

$ readlink -f symlink.txt    # полный путь
/home/user/original.txt
```

### Найти битые ссылки
```bash
$ find . -xtype l            # битые символические ссылки
$ find . -type l ! -exec test -e {} \; -print
```

### Исправить битую ссылку
```bash
$ ln -sf newpath brokenlink
```

## Ограничения

### Жёсткие ссылки не могут:
```bash
# 1. Ссылаться на директории
$ ln /home /mylink
ln: /home: hard link not allowed for directory

# 2. Пересекать файловые системы
$ ln /home/file /mnt/usb/link
ln: failed to create hard link: Invalid cross-device link
```

### Символические ссылки могут:
```bash
# 1. Ссылаться на директории
$ ln -s /var/log logs
$ cd logs    # работает!

# 2. Пересекать файловые системы
$ ln -s /home/file /mnt/usb/link    # работает

# 3. Быть битыми
$ ln -s nonexistent link
$ cat link
cat: link: No such file or directory
```

## Удаление ссылок

```bash
$ rm symlink           # удаляет только ссылку
$ unlink symlink       # альтернатива

# ОСТОРОЖНО с директориями:
$ rm linkdir           # правильно — удаляет ссылку
$ rm -r linkdir/       # ОПАСНО — удалит содержимое цели!
```

## Сравнение типов ссылок

| Характеристика | Жёсткая | Символическая |
|----------------|---------|---------------|
| На директории | Нет | Да |
| Между ФС | Нет | Да |
| Может быть битой | Нет | Да |
| Исходный файл удалён | Данные остаются | Ссылка битая |
| Как выглядит в ls | Обычный файл | `l` и `->` |

## Советы

1. **Используйте `-s` для большинства случаев** — символические ссылки гибче
2. **Используйте абсолютные пути** для надёжности
3. **Жёсткие ссылки** хороши для бэкапов
4. **Проверяйте ссылки** командой `readlink`
5. **Будьте осторожны** с `rm -r` на ссылках-директориях

---

[prev: 05-rm](./05-rm.md) | [next: 01-type-which](../05-working-with-commands/01-type-which.md)

# Data Patterns - Паттерны работы с данными

Этот раздел посвящён архитектурным паттернам для эффективной работы с данными в распределённых системах.

## Содержание

- [x] [CQRS](./01-cqrs.md) - Command Query Responsibility Segregation
- [x] [Event Sourcing](./02-event-sourcing.md) - Хранение состояния через события
- [x] [Sharding](./03-sharding.md) - Горизонтальное партиционирование данных
- [x] [Saga](./04-saga.md) - Управление распределёнными транзакциями

## Обзор паттернов

### CQRS (Command Query Responsibility Segregation)

Разделение операций чтения и записи на две отдельные модели. Позволяет оптимизировать каждую модель под свои задачи и независимо масштабировать чтение и запись.

**Когда использовать:**
- Высокая нагрузка на чтение (соотношение read/write > 100:1)
- Сложные запросы с агрегациями
- Разные представления одних данных

### Event Sourcing

Хранение не текущего состояния, а последовательности событий, которые к нему привели. Обеспечивает полный аудит, возможность восстановления состояния на любой момент времени и гибкость в построении проекций.

**Когда использовать:**
- Требуется полный аудит изменений
- Финансовые и банковские системы
- Системы с требованием "time travel"

### Sharding (Шардирование)

Горизонтальное разделение данных между несколькими серверами баз данных. Каждый шард содержит подмножество данных и работает независимо.

**Когда использовать:**
- Объём данных превышает возможности одного сервера
- Высокая нагрузка на запись
- Географическое распределение данных

### Saga Pattern

Управление распределёнными транзакциями через последовательность локальных транзакций с компенсирующими действиями. Решает проблему отсутствия ACID-транзакций между сервисами.

**Когда использовать:**
- Микросервисная архитектура
- Транзакции между несколькими сервисами
- Long-running бизнес-процессы

## Сравнительная таблица

| Паттерн | Сложность | Когда использовать | Главное преимущество |
|---------|-----------|-------------------|---------------------|
| CQRS | Средняя | Высокая нагрузка чтения | Независимое масштабирование |
| Event Sourcing | Высокая | Аудит и compliance | Полная история изменений |
| Sharding | Высокая | Большие объёмы данных | Горизонтальное масштабирование |
| Saga | Высокая | Распределённые транзакции | Консистентность между сервисами |

## Взаимосвязи паттернов

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                  │
│   CQRS ◄──────────────────► Event Sourcing                      │
│     │                              │                             │
│     │   Часто используются         │                             │
│     │   вместе                     │                             │
│     │                              │                             │
│     ▼                              ▼                             │
│   Sharding ◄───────────────► Saga Pattern                       │
│     │                              │                             │
│     │   Данные на разных           │  Координация между          │
│     │   шардах требуют Saga        │  шардами                    │
│     │                              │                             │
└─────────────────────────────────────────────────────────────────┘
```

## Рекомендуемый порядок изучения

1. **CQRS** — базовый паттерн, понимание которого необходимо для Event Sourcing
2. **Event Sourcing** — естественное продолжение CQRS
3. **Saga** — решение проблемы транзакций в распределённых системах
4. **Sharding** — масштабирование на уровне инфраструктуры

## Дополнительные ресурсы

### Книги
- "Designing Data-Intensive Applications" — Martin Kleppmann
- "Microservices Patterns" — Chris Richardson
- "Implementing Domain-Driven Design" — Vaughn Vernon

### Онлайн-ресурсы
- [microservices.io](https://microservices.io/patterns/) — каталог паттернов
- [Microsoft Cloud Patterns](https://docs.microsoft.com/en-us/azure/architecture/patterns/)

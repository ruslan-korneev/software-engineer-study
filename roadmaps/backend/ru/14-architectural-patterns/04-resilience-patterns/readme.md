# Resilience Patterns (Паттерны отказоустойчивости)

## Обзор

Паттерны отказоустойчивости (Resilience Patterns) — это архитектурные решения, которые помогают системам справляться со сбоями, перегрузками и недоступностью зависимых сервисов. Эти паттерны критически важны для построения надёжных распределённых систем и микросервисных архитектур.

```
┌─────────────────────────────────────────────────────────────────┐
│                    Resilience Patterns                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────────┐   ┌─────────────────┐                     │
│   │ Circuit Breaker │   │   Throttling    │                     │
│   │ (Fail-fast)     │   │ (Rate Limiting) │                     │
│   └─────────────────┘   └─────────────────┘                     │
│                                                                  │
│   ┌─────────────────────────────────────────┐                   │
│   │            Service Mesh                  │                   │
│   │  (Infrastructure-level resilience)       │                   │
│   └─────────────────────────────────────────┘                   │
│                                                                  │
│   Related patterns:                                              │
│   • Retry with Backoff                                          │
│   • Bulkhead                                                     │
│   • Timeout                                                      │
│   • Fallback                                                     │
│   • Health Check                                                 │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## Содержание раздела

- [x] [Circuit Breaker](./01-circuit-breaker.md) - Автоматический выключатель для защиты от каскадных сбоев
- [x] [Throttling (Rate Limiting)](./02-throttling.md) - Ограничение скорости запросов
- [x] [Service Mesh](./03-service-mesh.md) - Инфраструктурный слой для управления межсервисным взаимодействием

## Ключевые концепции

### Почему нужны паттерны отказоустойчивости?

В распределённых системах сбои неизбежны:
- Сетевые проблемы (latency, packet loss)
- Недоступность сервисов
- Перегрузка ресурсов
- Человеческие ошибки

**Resilience** — способность системы продолжать работу (возможно, в деградированном режиме) при частичных сбоях.

### Связь между паттернами

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                  │
│                         Request Flow                             │
│                                                                  │
│   Client                                                         │
│     │                                                            │
│     ▼                                                            │
│   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│   │ Rate Limit  │ ─► │   Timeout   │ ─► │   Retry     │         │
│   │ (Throttle)  │    │             │    │ (Backoff)   │         │
│   └─────────────┘    └─────────────┘    └──────┬──────┘         │
│                                                 │                │
│                                                 ▼                │
│                                         ┌─────────────┐         │
│                                         │  Circuit    │         │
│                                         │  Breaker    │         │
│                                         └──────┬──────┘         │
│                                                │                │
│                    ┌───────────────────────────┼────────┐       │
│                    │       Bulkhead            │        │       │
│                    │  ┌─────────────┐   ┌──────▼──────┐│       │
│                    │  │ Pool A      │   │ Pool B      ││       │
│                    │  └─────────────┘   └─────────────┘│       │
│                    └────────────────────────────────────┘       │
│                                                                  │
│                              Service                             │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## Сравнение паттернов

| Паттерн | Защита от | Основной механизм |
|---------|-----------|-------------------|
| **Circuit Breaker** | Каскадных сбоев | Fail-fast при обнаружении проблем |
| **Throttling** | Перегрузки | Ограничение rate запросов |
| **Bulkhead** | Исчерпания ресурсов | Изоляция пулов ресурсов |
| **Retry** | Временных сбоев | Повторные попытки с backoff |
| **Timeout** | Зависания | Ограничение времени ожидания |
| **Fallback** | Недоступности | Альтернативный путь выполнения |

## Порядок изучения

1. **Circuit Breaker** — базовый паттерн, понимание которого необходимо для всех остальных
2. **Throttling** — защита от перегрузки, часто используется совместно с Circuit Breaker
3. **Service Mesh** — инфраструктурная реализация всех паттернов

## Практическое применение

### Библиотеки по языкам

| Язык | Библиотеки |
|------|------------|
| Python | `pybreaker`, `tenacity`, `limits` |
| Java | `Resilience4j`, `Spring Cloud Circuit Breaker` |
| Go | `sony/gobreaker`, `afex/hystrix-go` |
| JavaScript | `opossum`, `cockatiel` |

### Инфраструктурные решения

- **Istio** — Service Mesh с полным набором resilience patterns
- **Linkerd** — Легковесный Service Mesh
- **Envoy** — Proxy с встроенной поддержкой паттернов
- **Kong** — API Gateway с rate limiting

## Ресурсы

- [Release It!](https://pragprog.com/titles/mnee2/release-it-second-edition/) — Michael Nygard
- [Microservices Patterns](https://microservices.io/patterns/index.html) — Chris Richardson
- [Microsoft Cloud Design Patterns](https://docs.microsoft.com/en-us/azure/architecture/patterns/)

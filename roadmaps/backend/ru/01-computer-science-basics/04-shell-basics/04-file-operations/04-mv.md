# Команда mv

## Что такое mv?

**mv** (move) — команда для перемещения и переименования файлов и директорий.

## Синтаксис

```bash
mv [опции] источник назначение
mv [опции] источник... директория
```

## Базовое использование

### Переименование файла
```bash
$ mv oldname.txt newname.txt
$ ls
newname.txt
```

### Перемещение файла
```bash
$ mv file.txt /home/user/documents/
$ mv file.txt ~/documents/          # с использованием ~
```

### Перемещение с переименованием
```bash
$ mv file.txt /backup/file-old.txt
```

### Перемещение нескольких файлов
```bash
$ mv file1.txt file2.txt file3.txt /archive/
$ mv *.log /logs/                   # все логи
```

## Основные опции

### -i (interactive) — запрос подтверждения

```bash
$ mv -i file.txt existing.txt
mv: overwrite 'existing.txt'? y
```

### -n (no-clobber) — не перезаписывать

```bash
$ mv -n file.txt existing.txt
# Не перезапишет existing.txt, молча пропустит
```

### -u (update) — перемещать только если новее

```bash
$ mv -u source.txt dest.txt
# Переместит только если source.txt новее dest.txt
```

### -v (verbose) — подробный вывод

```bash
$ mv -v file.txt /archive/
renamed 'file.txt' -> '/archive/file.txt'
```

### -f (force) — перезаписывать без вопросов

```bash
$ mv -f file.txt existing.txt
# Перезапишет без подтверждения
```

### -b (backup) — создать резервную копию

```bash
$ mv -b file.txt existing.txt
$ ls
existing.txt  existing.txt~   # ~ — резервная копия
```

## Практические примеры

### Переименование директории
```bash
$ mv old-project new-project
```

### Перемещение директории
```bash
$ mv project /backup/
# Директории не требуют -r (в отличие от cp)
```

### Массовое переименование с wildcards
```bash
# Переместить все .txt в /backup
$ mv *.txt /backup/

# Переименовать все .jpeg в .jpg (нужен цикл)
$ for f in *.jpeg; do mv "$f" "${f%.jpeg}.jpg"; done
```

### Переименование с датой
```bash
$ mv config.yaml config.yaml.$(date +%Y%m%d)
$ ls
config.yaml.20241226
```

### Безопасное перемещение
```bash
$ mv -iv file.txt /archive/
mv: overwrite '/archive/file.txt'? y
renamed 'file.txt' -> '/archive/file.txt'
```

## Разница между mv и cp

| Аспект | mv | cp |
|--------|----|----|
| Исходный файл | Удаляется | Остаётся |
| Скорость на одном диске | Мгновенно | Копирует данные |
| Директории | Работает сразу | Требует -r |
| Права | Сохраняются | Могут измениться |

### Особенность mv на одном диске
На одном диске `mv` просто меняет запись в файловой системе, не копируя данные:
```bash
$ mv huge-file.tar /same-disk/backup/   # мгновенно, даже 100GB
$ mv huge-file.tar /other-disk/backup/  # копирует данные
```

## Поведение с директориями назначения

```bash
# Если dest НЕ существует — переименовывает
$ mv source dest
# source → dest

# Если dest существует и это директория — перемещает ВНУТРЬ
$ mv source dest/
# source → dest/source
```

## Обработка ошибок

### Нет прав на исходный файл
```bash
$ mv /root/file.txt ~/
mv: cannot move '/root/file.txt': Permission denied
```

### Нет прав на директорию назначения
```bash
$ mv file.txt /etc/
mv: cannot move 'file.txt' to '/etc/file.txt': Permission denied
```

### Перемещение между файловыми системами
Если перемещение между разными файловыми системами, `mv` копирует файл, а затем удаляет оригинал. Это может быть медленнее.

## Атомарность операции

На одной файловой системе `mv` — атомарная операция:
```bash
$ mv new-config.yaml config.yaml
# Гарантированно: либо старый, либо новый файл, но не повреждённый
```

Это полезно для безопасного обновления файлов.

## Комбинации с другими командами

### Переименование с бэкапом
```bash
$ cp file.txt file.txt.bak && mv newfile.txt file.txt
```

### Перемещение и создание ссылки
```bash
$ mv file.txt /archive/ && ln -s /archive/file.txt ./
```

## Альтернативы для массового переименования

### rename (Perl)
```bash
$ rename 's/.jpeg/.jpg/' *.jpeg   # все .jpeg → .jpg
$ rename 's/prefix_//' *.txt      # убрать prefix_ из имён
```

### mmv
```bash
$ mmv '*.jpeg' '#1.jpg'
```

## Советы

1. **Используйте -i для важных операций**:
   ```bash
   mv -i important.txt /archive/
   ```

2. **Используйте -v для отслеживания**:
   ```bash
   mv -v *.log /archive/
   ```

3. **Для массового переименования** используйте `rename` или цикл

4. **mv быстрее cp + rm** на одном диске

5. **Проверяйте wildcards**:
   ```bash
   ls *.txt          # что будет перемещено?
   mv *.txt /backup/
   ```

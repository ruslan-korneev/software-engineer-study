# История команд

## Что такое история команд?

**История команд** — это функция shell, которая сохраняет все введённые команды. Это позволяет быстро повторять предыдущие команды без повторного ввода.

## Навигация по истории

### Стрелки вверх/вниз
- **↑** (стрелка вверх) — предыдущая команда
- **↓** (стрелка вниз) — следующая команда

Просто нажимайте стрелку вверх, чтобы пролистывать историю.

## Команда history

```bash
$ history           # показать всю историю команд
$ history 10        # показать последние 10 команд
$ history | less    # просмотр истории постранично
```

Пример вывода:
```
  501  cd /home
  502  ls -la
  503  cat file.txt
  504  history
```

## Выполнение команд из истории

### По номеру
```bash
$ !502              # выполнить команду под номером 502
$ !-1               # выполнить предыдущую команду (то же что !!)
$ !-3               # выполнить третью с конца команду
```

### По началу команды
```bash
$ !ls               # выполнить последнюю команду, начинающуюся с 'ls'
$ !cat              # выполнить последнюю команду 'cat...'
```

### Повторение последней команды
```bash
$ !!                # выполнить предыдущую команду
$ sudo !!           # выполнить предыдущую команду с sudo
```

Это очень полезно, когда забыли добавить `sudo`:
```bash
$ apt update        # Permission denied!
$ sudo !!           # автоматически выполнит: sudo apt update
```

## Поиск в истории

### Ctrl + R — интерактивный поиск
Нажмите **Ctrl+R** и начните вводить часть команды:

```
(reverse-i-search)`git': git push origin main
```

- Продолжайте вводить для уточнения поиска
- **Ctrl+R** снова — следующее совпадение
- **Enter** — выполнить найденную команду
- **Ctrl+G** или **Esc** — отмена поиска

### Поиск с grep
```bash
$ history | grep ssh        # найти все команды с 'ssh'
$ history | grep "git push" # найти команды git push
```

## Файл истории

История сохраняется в файле (обычно `~/.bash_history` или `~/.zsh_history`):

```bash
$ cat ~/.bash_history       # посмотреть файл истории
$ echo $HISTFILE            # путь к файлу истории
$ echo $HISTSIZE            # количество команд в памяти
$ echo $HISTFILESIZE        # количество команд в файле
```

## Управление историей

### Очистка истории
```bash
$ history -c        # очистить историю текущей сессии
$ history -w        # записать историю в файл
```

### Игнорирование команд
В конфигурации shell можно настроить:

```bash
# В ~/.bashrc
export HISTCONTROL=ignoredups      # игнорировать дубликаты
export HISTCONTROL=ignorespace     # игнорировать команды с пробелом в начале
export HISTCONTROL=ignoreboth      # оба варианта
export HISTIGNORE="ls:cd:pwd"      # игнорировать конкретные команды
```

## Полезные приёмы

### Использование аргументов предыдущей команды
```bash
$ mkdir myproject
$ cd !$             # !$ = последний аргумент = myproject
```

### Все аргументы предыдущей команды
```bash
$ echo one two three
$ echo !*           # выведет: one two three
```

## Советы

1. Регулярно используйте **Ctrl+R** — это быстрее стрелок
2. Добавляйте пробел перед командой, если не хотите сохранять её в истории
3. Увеличьте `HISTSIZE` для более длинной истории

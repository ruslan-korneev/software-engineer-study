# Владельцы и группы (Owners and Groups)

## Модель безопасности Unix

В Unix/Linux каждый файл и директория имеют:
- **Владельца** (owner/user) — обычно создатель файла
- **Группу** (group) — набор пользователей с общими правами
- **Права для остальных** (others) — все остальные пользователи

## Просмотр владельца и группы

```bash
$ ls -l
-rw-r--r-- 1 alice developers 4096 Dec 26 10:00 file.txt
              ↑      ↑
           owner   group
```

Разбор вывода:
```
-rw-r--r--  1  alice  developers  4096  Dec 26 10:00  file.txt
│          │    │        │         │         │           │
│          │    │        │         │         │           └── имя
│          │    │        │         │         └── дата изменения
│          │    │        │         └── размер
│          │    │        └── группа
│          │    └── владелец
│          └── количество жёстких ссылок
└── права доступа
```

## Пользователи

### Информация о текущем пользователе
```bash
$ whoami
alice

$ id
uid=1000(alice) gid=1000(alice) groups=1000(alice),27(sudo),100(users)

$ id alice
uid=1000(alice) gid=1000(alice) groups=1000(alice),27(sudo),100(users)
```

### Файл пользователей
```bash
$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
alice:x:1000:1000:Alice:/home/alice:/bin/bash
bob:x:1001:1001:Bob:/home/bob:/bin/bash
```

Формат: `username:x:UID:GID:comment:home:shell`

### Специальные пользователи
| UID | Пользователь | Назначение |
|-----|--------------|------------|
| 0 | root | Суперпользователь |
| 1-999 | системные | Сервисы (www-data, mysql) |
| 1000+ | обычные | Реальные пользователи |

## Группы

### Группы пользователя
```bash
$ groups
alice sudo developers docker

$ groups alice
alice : alice sudo developers docker
```

### Файл групп
```bash
$ cat /etc/group
sudo:x:27:alice,bob
developers:x:1002:alice,charlie
docker:x:999:alice
```

Формат: `groupname:x:GID:members`

### Первичная и дополнительные группы
- **Первичная группа** — GID из /etc/passwd, назначается новым файлам
- **Дополнительные группы** — из /etc/group

```bash
$ id alice
uid=1000(alice) gid=1000(alice) groups=1000(alice),27(sudo),1002(developers)
                ↑                       ↑
           первичная              дополнительные
```

## Права доступа

### Три типа прав
| Символ | Число | Для файла | Для директории |
|--------|-------|-----------|----------------|
| `r` | 4 | Чтение содержимого | Просмотр списка файлов |
| `w` | 2 | Изменение содержимого | Создание/удаление файлов |
| `x` | 1 | Выполнение | Вход в директорию (cd) |

### Три категории пользователей
| Категория | Описание |
|-----------|----------|
| **u** (user) | Владелец файла |
| **g** (group) | Члены группы файла |
| **o** (others) | Все остальные |
| **a** (all) | Все три категории |

### Разбор прав
```
-rwxr-xr--
│├─┤├─┤├─┤
│ │  │  └── others: r-- (только чтение)
│ │  └── group: r-x (чтение + выполнение)
│ └── owner: rwx (все права)
└── тип файла (- = обычный файл)
```

## Типы файлов

| Символ | Тип |
|--------|-----|
| `-` | Обычный файл |
| `d` | Директория |
| `l` | Символическая ссылка |
| `c` | Символьное устройство |
| `b` | Блочное устройство |
| `s` | Сокет |
| `p` | Именованный канал (FIFO) |

## Числовое представление прав

```
rwx = 4+2+1 = 7
rw- = 4+2+0 = 6
r-x = 4+0+1 = 5
r-- = 4+0+0 = 4
```

Примеры:
```
rwxr-xr-x = 755
rw-r--r-- = 644
rwx------ = 700
rw-rw-r-- = 664
```

## Практические примеры

### Типичные права
```bash
# Исполняемый файл
-rwxr-xr-x (755) script.sh

# Обычный файл
-rw-r--r-- (644) document.txt

# Приватный файл
-rw------- (600) secrets.txt

# Директория
drwxr-xr-x (755) project/

# Приватная директория
drwx------ (700) private/
```

### Проверка прав
```bash
$ ls -la /etc/shadow
-rw-r----- 1 root shadow 1234 Dec 26 10:00 /etc/shadow
# Только root и группа shadow могут читать
```

## Специальные биты

### SUID (Set User ID)
```bash
-rwsr-xr-x root root /usr/bin/passwd
   ↑
  SUID — выполняется с правами владельца (root)
```

### SGID (Set Group ID)
```bash
-rwxr-sr-x root mail /usr/bin/write
      ↑
    SGID — выполняется с правами группы
```

### Sticky bit
```bash
drwxrwxrwt root root /tmp
         ↑
      sticky — удалять файлы может только владелец
```

## Команды для просмотра

```bash
$ ls -l file.txt           # права одного файла
$ ls -la                   # все файлы включая скрытые
$ stat file.txt            # подробная информация
$ namei -l /path/to/file   # права всей цепочки директорий
```

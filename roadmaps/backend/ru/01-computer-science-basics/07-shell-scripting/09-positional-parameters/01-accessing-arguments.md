# Доступ к аргументам

## Что такое позиционные параметры

Позиционные параметры - это аргументы, переданные скрипту или функции при вызове:

```bash
./script.sh arg1 arg2 arg3
#           $1   $2   $3
```

## Основные переменные

| Переменная | Описание |
|------------|----------|
| `$0` | Имя скрипта |
| `$1` - `$9` | Первые 9 аргументов |
| `${10}`, `${11}` | Аргументы от 10 и выше |
| `$#` | Количество аргументов |
| `$@` | Все аргументы (как отдельные слова) |
| `$*` | Все аргументы (как одна строка) |

## $0 - имя скрипта

```bash
#!/bin/bash

echo "Имя скрипта: $0"
echo "Базовое имя: $(basename "$0")"
echo "Директория: $(dirname "$0")"
```

Вывод при запуске `./scripts/myscript.sh`:
```
Имя скрипта: ./scripts/myscript.sh
Базовое имя: myscript.sh
Директория: ./scripts
```

## $1, $2, ... $N - аргументы

```bash
#!/bin/bash

echo "Первый аргумент: $1"
echo "Второй аргумент: $2"
echo "Третий аргумент: $3"

# Для аргументов >= 10 нужны фигурные скобки
echo "Десятый аргумент: ${10}"
```

### Значения по умолчанию

```bash
#!/bin/bash

# Если аргумент не передан, использовать значение по умолчанию
name=${1:-"Anonymous"}
port=${2:-8080}

echo "Имя: $name"
echo "Порт: $port"
```

### Обязательные аргументы

```bash
#!/bin/bash

# Выход с ошибкой, если аргумент не передан
name=${1:?"Ошибка: имя не указано"}
```

## $# - количество аргументов

```bash
#!/bin/bash

echo "Количество аргументов: $#"

# Проверка количества аргументов
if [[ $# -lt 2 ]]; then
    echo "Использование: $0 <source> <destination>"
    exit 1
fi
```

## $@ vs $*

### Без кавычек (одинаковое поведение)

```bash
#!/bin/bash
# test.sh

for arg in $@; do
    echo "arg: $arg"
done

for arg in $*; do
    echo "arg: $arg"
done
```

### С кавычками (разное поведение!)

```bash
#!/bin/bash
# test.sh

echo "=== \"\$@\" ==="
for arg in "$@"; do
    echo "arg: [$arg]"
done

echo "=== \"\$*\" ==="
for arg in "$*"; do
    echo "arg: [$arg]"
done
```

Запуск: `./test.sh "hello world" foo bar`

Вывод:
```
=== "$@" ===
arg: [hello world]
arg: [foo]
arg: [bar]
=== "$*" ===
arg: [hello world foo bar]
```

**Важно:**
- `"$@"` - каждый аргумент как отдельное слово (сохраняет пробелы)
- `"$*"` - все аргументы как одна строка

**Рекомендация:** Почти всегда используйте `"$@"`.

## Практические примеры

### Скрипт с обязательными аргументами

```bash
#!/bin/bash

usage() {
    echo "Использование: $(basename "$0") <source_file> <dest_file>"
    echo ""
    echo "Копирует source_file в dest_file с логированием"
    exit 1
}

# Проверка количества аргументов
if [[ $# -ne 2 ]]; then
    usage
fi

source_file=$1
dest_file=$2

# Проверка существования исходного файла
if [[ ! -f "$source_file" ]]; then
    echo "Ошибка: файл '$source_file' не найден"
    exit 1
fi

# Выполнение операции
cp "$source_file" "$dest_file"
echo "Скопировано: $source_file -> $dest_file"
```

### Передача аргументов другому скрипту

```bash
#!/bin/bash
# wrapper.sh

# Передача всех аргументов другому скрипту
./actual_script.sh "$@"

# Передача с дополнительными аргументами
./actual_script.sh --verbose "$@"
```

### Обработка файлов

```bash
#!/bin/bash

if [[ $# -eq 0 ]]; then
    echo "Использование: $0 <file1> [file2] ..."
    exit 1
fi

for file in "$@"; do
    if [[ -f "$file" ]]; then
        echo "Обработка: $file"
        # ... обработка ...
    else
        echo "Пропуск (не файл): $file"
    fi
done

echo "Обработано файлов: $#"
```

### Функции с аргументами

```bash
#!/bin/bash

greet() {
    local name=${1:-"Guest"}
    local greeting=${2:-"Hello"}

    echo "$greeting, $name!"
}

add() {
    echo $(($1 + $2))
}

# Вызов функций
greet "Alice" "Hi"      # Hi, Alice!
greet "Bob"             # Hello, Bob!
greet                   # Hello, Guest!

result=$(add 5 3)
echo "Сумма: $result"   # Сумма: 8
```

## Доступ к аргументам по индексу

### Косвенный доступ

```bash
#!/bin/bash

# Получение N-го аргумента
get_arg() {
    local n=$1
    shift
    local args=("$@")
    echo "${args[$((n-1))]}"
}

# Использование
echo "Третий аргумент: $(get_arg 3 "$@")"
```

### Массив аргументов

```bash
#!/bin/bash

# Все аргументы в массив
args=("$@")

echo "Первый: ${args[0]}"
echo "Последний: ${args[-1]}"
echo "Количество: ${#args[@]}"

# Срез аргументов
echo "Со второго по четвёртый: ${args[@]:1:3}"
```

## Специальные случаи

### Аргументы с пробелами

```bash
#!/bin/bash
# Запуск: ./script.sh "hello world" "foo bar"

# ПРАВИЛЬНО - с кавычками
for arg in "$@"; do
    echo "[$arg]"
done

# НЕПРАВИЛЬНО - без кавычек (разбивает по пробелам)
for arg in $@; do
    echo "[$arg]"
done
```

### Аргументы, начинающиеся с дефиса

```bash
#!/bin/bash

# Проблема: -v может быть интерпретировано как опция
echo $1

# Решение: использовать -- для обозначения конца опций
echo -- "$1"
```

## Позиционные параметры в функциях

```bash
#!/bin/bash

# В функции $0 всё ещё имя скрипта, не функции!
my_function() {
    echo "\$0 = $0"          # Имя скрипта
    echo "\$FUNCNAME = $FUNCNAME"  # Имя функции
    echo "\$1 = $1"          # Первый аргумент функции
    echo "\$# = $#"          # Количество аргументов функции
}

# Аргументы скрипта
echo "Аргументы скрипта: $@"

# Вызов функции с другими аргументами
my_function "func_arg1" "func_arg2"
```

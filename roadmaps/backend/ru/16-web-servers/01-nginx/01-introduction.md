# Введение в Nginx

## Что такое Nginx

**Nginx** (произносится "энджин-экс") — это высокопроизводительный веб-сервер и обратный прокси-сервер с открытым исходным кодом. Также используется как балансировщик нагрузки, HTTP-кэш и почтовый прокси-сервер.

## История создания

Nginx был создан **Игорем Сысоевым** в 2002 году как решение проблемы C10K (обработка 10 000 одновременных соединений). Первый публичный релиз состоялся в **2004 году**.

**Ключевые даты:**
- 2002 — начало разработки
- 2004 — первый публичный релиз
- 2011 — основание компании Nginx Inc.
- 2019 — приобретение компанией F5 Networks
- 2024 — Nginx остаётся одним из самых популярных веб-серверов в мире

## Архитектура

Nginx использует **событийно-ориентированную (event-driven)** асинхронную архитектуру, что позволяет обрабатывать тысячи соединений с минимальным потреблением памяти.

### Модель процессов

```
                    ┌─────────────────┐
                    │  Master Process │
                    │   (pid: 1)      │
                    └────────┬────────┘
                             │
        ┌────────────────────┼────────────────────┐
        │                    │                    │
        ▼                    ▼                    ▼
┌───────────────┐   ┌───────────────┐   ┌───────────────┐
│ Worker Process│   │ Worker Process│   │ Worker Process│
│   (pid: 2)    │   │   (pid: 3)    │   │   (pid: 4)    │
└───────────────┘   └───────────────┘   └───────────────┘
```

**Master процесс:**
- Читает и проверяет конфигурацию
- Управляет worker-процессами
- Обрабатывает сигналы (reload, stop)
- Открывает сетевые порты

**Worker процессы:**
- Обрабатывают клиентские запросы
- Используют неблокирующий ввод-вывод
- Работают независимо друг от друга
- Количество обычно равно числу CPU-ядер

### Event Loop

Каждый worker использует **event loop** (цикл обработки событий):

```
┌──────────────────────────────────────────┐
│              Event Loop                  │
│                                          │
│  ┌─────────┐   ┌─────────┐   ┌─────────┐│
│  │ Event 1 │ → │ Event 2 │ → │ Event 3 ││
│  └─────────┘   └─────────┘   └─────────┘│
│       ↑                            │     │
│       └────────────────────────────┘     │
│                                          │
└──────────────────────────────────────────┘
```

Это позволяет одному процессу обрабатывать множество соединений без создания отдельного потока для каждого.

## Сравнение с Apache

| Характеристика | Nginx | Apache |
|----------------|-------|--------|
| Архитектура | Event-driven, асинхронная | Process/Thread-based |
| Память на соединение | ~2.5 МБ на 10K соединений | ~256 МБ на 10K соединений |
| Статический контент | Очень быстро | Медленнее |
| Динамический контент | Через FastCGI/proxy | Встроенные модули (mod_php) |
| .htaccess | Не поддерживается | Поддерживается |
| Конфигурация | Централизованная | Распределённая (.htaccess) |

### Когда выбирать Nginx:
- Высоконагруженные сайты
- Reverse proxy / балансировка
- Раздача статического контента
- Микросервисная архитектура

### Когда выбирать Apache:
- Shared hosting (нужен .htaccess)
- Сложная логика на уровне директорий
- Существующие mod_* модули

## Области применения

### 1. Веб-сервер
Раздача статического контента (HTML, CSS, JS, изображения).

### 2. Reverse Proxy
Проксирование запросов к backend-серверам (Node.js, Python, Go, PHP-FPM).

### 3. Балансировщик нагрузки
Распределение трафика между несколькими серверами.

### 4. SSL/TLS терминация
Обработка HTTPS на nginx, передача HTTP на backend.

### 5. HTTP-кэширование
Кэширование ответов backend-серверов.

### 6. API Gateway
Маршрутизация запросов к микросервисам.

## Статистика использования

По данным W3Techs (2024):
- Nginx используется на **~34%** всех веб-сайтов
- Это самый популярный веб-сервер в мире
- Используется такими компаниями как Netflix, Cloudflare, GitHub, WordPress.com

## Версии Nginx

### Nginx Open Source
- Бесплатный и с открытым исходным кодом
- Основные функции веб-сервера и прокси
- Активное сообщество

### Nginx Plus
- Коммерческая версия с поддержкой
- Расширенная балансировка (health checks)
- Мониторинг в реальном времени
- Session persistence
- Динамическое управление конфигурацией

## Дополнительные ресурсы

- [Официальная документация](https://nginx.org/ru/docs/)
- [Nginx Wiki](https://wiki.nginx.org/)
- [Книга "AOSA - Nginx"](https://www.aosabook.org/en/nginx.html)

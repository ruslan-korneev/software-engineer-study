# Everscale (бывший Free TON)

## История создания

### От TON к Free TON и Everscale

**Everscale** — это форк оригинального TON, созданный после того, как Telegram был вынужден отказаться от проекта из-за иска SEC.

```
┌────────────────────────────────────────────────────────────────────┐
│                    История Everscale                               │
├────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  Май 2020  │ Telegram отказывается от TON после иска SEC          │
│            │                                                        │
│  Май 2020  │ Сообщество запускает Free TON                         │
│            │ • Используется открытый код TON                       │
│            │ • Новая экономическая модель (без ICO)                │
│            │ • Децентрализованное управление                       │
│            │                                                        │
│  2021      │ Активное развитие экосистемы                          │
│            │ • DeFi протоколы                                      │
│            │ • Мосты с другими сетями                              │
│            │                                                        │
│  Нояб 2021 │ Ребрендинг: Free TON → Everscale                      │
│            │ • Отход от названия TON (избежание путаницы)          │
│            │ • Новая идентичность                                  │
│            │                                                        │
│  2022-2024 │ Развитие корпоративных решений                        │
│            │ • Venom (отдельный проект на базе технологии)         │
│            │ • Enterprise-решения                                  │
│            │                                                        │
└────────────────────────────────────────────────────────────────────┘
```

### Основатели и сообщество

В отличие от TON, Everscale изначально был **community-driven проектом**:

- **TON Labs** (позже Everscale DeFi Alliance) — основные разработчики
- **Никакого ICO** — токены распределялись через конкурсы и гранты
- **Децентрализованное управление** — решения принимаются голосованием

## Техническая архитектура

### Основа: TVM и модификации

Everscale использует модифицированную версию TVM с улучшениями:

```
┌─────────────────────────────────────────────────────────────────┐
│              Архитектура Everscale                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────┐                                            │
│  │   Masterchain   │ ← Координация, конфигурация сети          │
│  └────────┬────────┘                                            │
│           │                                                      │
│    ┌──────┴──────┐                                              │
│    │             │                                               │
│  ┌─┴─┐        ┌──┴───────────────────────┐                      │
│  │WC0│        │      Workchains 1-N      │                      │
│  └─┬─┘        │  (кастомные правила)     │                      │
│    │          └──────────────────────────┘                      │
│    │                                                             │
│  ┌─┴─────────────────────────────────┐                          │
│  │        Динамические шарды         │                          │
│  │  ┌────┐ ┌────┐ ┌────┐ ┌────┐      │                          │
│  │  │S1  │ │S2  │ │S3  │ │... │      │ ← Авто-масштабирование  │
│  │  └────┘ └────┘ └────┘ └────┘      │                          │
│  └───────────────────────────────────┘                          │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### Динамический шардинг (Dynamic Sharding)

Everscale развил идею шардинга TON:

| Аспект | TON | Everscale |
|--------|-----|-----------|
| **Split/Merge** | Базовый | Улучшенный алгоритм |
| **Thread** | Нет | Многопоточность внутри шарда |
| **Скорость адаптации** | Стандартная | Ускоренная |

```
┌────────────────────────────────────────────────────────────────┐
│            Динамический шардинг в Everscale                    │
├────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Нагрузка низкая:                                              │
│  ┌─────────────────────────────────────────┐                   │
│  │              Shard 0                    │                   │
│  └─────────────────────────────────────────┘                   │
│                                                                 │
│  Нагрузка растёт → Split:                                      │
│  ┌──────────────────┐  ┌──────────────────┐                    │
│  │    Shard 0/2     │  │    Shard 1/2     │                    │
│  └──────────────────┘  └──────────────────┘                    │
│                                                                 │
│  Нагрузка падает → Merge:                                      │
│  ┌─────────────────────────────────────────┐                   │
│  │              Shard 0                    │                   │
│  └─────────────────────────────────────────┘                   │
│                                                                 │
│  * Процесс автоматический и прозрачный для пользователей      │
│                                                                 │
└────────────────────────────────────────────────────────────────┘
```

### Консенсус: Soft Majority Fault Tolerance (SMFT)

Everscale использует модифицированный BFT консенсус:

```
┌────────────────────────────────────────────────────────────────┐
│          Soft Majority Fault Tolerance (SMFT)                  │
├────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Классический BFT:                                             │
│  • Требует 2/3 + 1 голосов для консенсуса                      │
│  • Жёсткие требования к отклику                                │
│                                                                 │
│  SMFT (Everscale):                                             │
│  • Мягкие требования к большинству                             │
│  • Адаптивная настройка порогов                                │
│  • Более высокая устойчивость к задержкам сети                │
│                                                                 │
│  Преимущества:                                                 │
│  ✓ Быстрее достигается консенсус                              │
│  ✓ Лучше работает в реальных сетевых условиях                 │
│  ✓ Меньше зависимость от отдельных валидаторов                │
│                                                                 │
└────────────────────────────────────────────────────────────────┘
```

## Отличия от TON

### Технические различия

```
┌─────────────────────┬──────────────────────┬──────────────────────┐
│     Параметр        │        TON           │      Everscale       │
├─────────────────────┼──────────────────────┼──────────────────────┤
│ Консенсус           │ BFT PoS              │ SMFT                 │
│ Язык контрактов     │ FunC, Tact, Fift     │ Solidity++, T-Sol    │
│ Multithreading      │ Нет                  │ Да (внутри шарда)    │
│ Управление          │ TON Foundation       │ DAO (голосование)    │
│ Telegram интеграция │ Глубокая             │ Нет                  │
│ Фокус               │ Mass adoption        │ Enterprise/DeFi      │
│ Токеномика          │ ICO (возвращено)     │ Конкурсы, гранты     │
└─────────────────────┴──────────────────────┴──────────────────────┘
```

### Философские различия

| Аспект | TON | Everscale |
|--------|-----|-----------|
| **Целевая аудитория** | Массовый пользователь | Разработчики, предприятия |
| **Управление** | Централизованное (Foundation) | Децентрализованное (DAO) |
| **Партнёрства** | Telegram-centric | Открытое сотрудничество |
| **Маркетинг** | Активный (через Telegram) | Органический рост |

## Языки разработки

### Solidity++ (T-Sol)

Everscale адаптировал Solidity для TVM, создав **Solidity++** (также известный как T-Sol):

```solidity
// Solidity++ для Everscale
pragma ever-solidity >= 0.62.0;

contract Counter {
    uint64 public counter;
    address public owner;

    // Модификатор для проверки владельца
    modifier onlyOwner {
        require(msg.pubkey() == tvm.pubkey(), 101);
        tvm.accept();  // Принять внешнее сообщение
        _;
    }

    // Конструктор
    constructor() public {
        require(tvm.pubkey() != 0, 100);
        tvm.accept();
        owner = address(this);
        counter = 0;
    }

    // Увеличить счётчик (внешний вызов)
    function increment() public onlyOwner {
        counter++;
    }

    // Увеличить на заданное значение (внутренний вызов)
    function incrementBy(uint64 value) public {
        require(msg.sender == owner, 102);
        counter += value;
    }

    // Получить значение
    function getCounter() public view returns (uint64) {
        return counter;
    }
}
```

### Особенности Solidity++ vs Solidity (EVM)

```
┌─────────────────────────────────────────────────────────────────┐
│           Solidity++ vs стандартный Solidity                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  Новые концепции в Solidity++:                                  │
│                                                                  │
│  1. tvm.accept()                                                │
│     • Принимает внешнее сообщение                               │
│     • Необходим для обработки вызовов без TON                   │
│                                                                  │
│  2. msg.pubkey()                                                │
│     • Публичный ключ отправителя                                │
│     • Используется для авторизации                              │
│                                                                  │
│  3. Асинхронные вызовы                                          │
│     • Все межконтрактные вызовы асинхронны                      │
│     • Нужны callback-функции для получения ответов              │
│                                                                  │
│  4. Ответственные функции (responsible)                         │
│     • Автоматическая отправка ответа вызывающему                │
│                                                                  │
│  5. Деплой контрактов                                           │
│     • new Contract{...}() для деплоя                            │
│     • Нужно указать stateInit                                   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### Пример асинхронного взаимодействия

```solidity
pragma ever-solidity >= 0.62.0;

interface IRemoteContract {
    function getValue() external responsible returns (uint64);
}

contract AsyncCaller {
    uint64 public lastReceivedValue;
    address public remoteContract;

    constructor(address _remote) public {
        tvm.accept();
        remoteContract = _remote;
    }

    // Запрос значения из другого контракта
    function requestValue() public {
        tvm.accept();

        // Асинхронный вызов с callback
        IRemoteContract(remoteContract).getValue{
            value: 0.1 ever,      // Отправляем газ
            bounce: true,          // Возврат при ошибке
            callback: onValueReceived  // Callback функция
        }();
    }

    // Callback для получения ответа
    function onValueReceived(uint64 value) public {
        require(msg.sender == remoteContract, 100);
        lastReceivedValue = value;
    }
}

contract RemoteContract is IRemoteContract {
    uint64 private value = 42;

    constructor() public {
        tvm.accept();
    }

    // Responsible функция автоматически отправляет ответ
    function getValue() public responsible override returns (uint64) {
        return{value: 0, bounce: false, flag: 64} value;
    }
}
```

## Инструменты разработки

### Ever SDK

```bash
# Установка Ever SDK для Node.js
npm install --save @eversdk/core @eversdk/lib-node

# Для браузера
npm install --save @eversdk/core @eversdk/lib-web
```

### Пример использования Ever SDK

```typescript
import { TonClient } from "@eversdk/core";
import { libNode } from "@eversdk/lib-node";

// Инициализация
TonClient.useBinaryLibrary(libNode);

const client = new TonClient({
    network: {
        endpoints: ["https://devnet.evercloud.dev/your-project-id/graphql"]
    }
});

// Деплой контракта
async function deployContract() {
    const { transaction } = await client.processing.process_message({
        message_encode_params: {
            abi: {
                type: "Contract",
                value: contractAbi
            },
            deploy_set: {
                tvc: contractTvc,
                initial_data: {}
            },
            call_set: {
                function_name: "constructor",
                input: {}
            },
            signer: {
                type: "Keys",
                keys: keyPair
            }
        },
        send_events: false
    });

    console.log("Contract deployed:", transaction.account_addr);
}

// Вызов функции
async function callContract(address: string) {
    const result = await client.processing.process_message({
        message_encode_params: {
            abi: { type: "Contract", value: contractAbi },
            address: address,
            call_set: {
                function_name: "increment",
                input: {}
            },
            signer: { type: "Keys", keys: keyPair }
        },
        send_events: false
    });

    return result;
}
```

### Компилятор и CLI

```bash
# Установка компилятора
npm install -g everdev

# Компиляция Solidity++
everdev sol compile Counter.sol

# Результат:
# Counter.abi.json  - ABI контракта
# Counter.tvc       - Скомпилированный код

# Локальная нода для разработки
everdev se start

# Деплой на локальную ноду
everdev contract deploy Counter --network se
```

## Экосистема и управление

### DAO-управление

```
┌────────────────────────────────────────────────────────────────┐
│               Управление в Everscale                           │
├────────────────────────────────────────────────────────────────┤
│                                                                 │
│                    ┌───────────────────┐                       │
│                    │   Soft Majority   │                       │
│                    │   Voting (SMV)    │                       │
│                    └─────────┬─────────┘                       │
│                              │                                  │
│           ┌──────────────────┼──────────────────┐              │
│           │                  │                  │               │
│   ┌───────┴───────┐  ┌───────┴───────┐  ┌───────┴───────┐     │
│   │   Subgovs     │  │     DeFi      │  │    Grants     │     │
│   │ (субуправление)│  │  Alliance    │  │    Givers    │     │
│   └───────────────┘  └───────────────┘  └───────────────┘     │
│                                                                 │
│   Любой держатель EVER может:                                  │
│   • Голосовать за предложения                                  │
│   • Создавать свои предложения                                 │
│   • Участвовать в конкурсах                                    │
│                                                                 │
└────────────────────────────────────────────────────────────────┘
```

### Основные проекты экосистемы

| Проект | Описание |
|--------|----------|
| **FlatQube** | DEX (децентрализованная биржа) |
| **Octus Bridge** | Мост между Everscale и другими сетями |
| **EVER Wallet** | Официальный кошелёк |
| **Surf** | Браузер-кошелёк |
| **Grandbazar** | NFT маркетплейс |

### Venom — корпоративный форк

**Venom** — отдельный блокчейн, использующий технологию Everscale для корпоративных решений:

```
┌────────────────────────────────────────────────────────────────┐
│                     Venom Network                              │
├────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Технология: Everscale TVM                                     │
│  Фокус: Корпоративные решения, Middle East                     │
│  Лицензия: Первый лицензированный блокчейн в Abu Dhabi        │
│                                                                 │
│  Особенности:                                                  │
│  • Регуляторная совместимость                                  │
│  • Корпоративные use-cases                                     │
│  • Партнёрства с традиционным бизнесом                        │
│                                                                 │
└────────────────────────────────────────────────────────────────┘
```

## Преимущества Everscale

1. **Истинная децентрализация** — нет центрального контролирующего органа
2. **Знакомый синтаксис** — Solidity++ проще для EVM-разработчиков
3. **Масштабируемость** — динамический шардинг + multithreading
4. **Продвинутое управление** — DAO с проверенной историей
5. **Enterprise-ready** — опыт Venom показывает применимость в бизнесе

## Недостатки и риски

1. **Меньшая экосистема** — по сравнению с TON и тем более EVM
2. **Сложность входа** — асинхронная модель требует переобучения
3. **Низкая узнаваемость** — меньше внимания медиа
4. **Конкуренция с TON** — сложно конкурировать с Telegram-интеграцией
5. **Меньше ликвидности** — объёмы торгов ниже, чем у TON

## Сравнение с конкурентами

```
┌─────────────────┬─────────────────┬─────────────────┬─────────────────┐
│   Параметр      │    Everscale    │      TON        │    Ethereum     │
├─────────────────┼─────────────────┼─────────────────┼─────────────────┤
│ TPS             │ 100,000+        │ 100,000+        │ ~30             │
│ Финальность     │ ~2-3 сек        │ ~5-6 сек        │ ~15 мин         │
│ Шардинг         │ Динамический    │ Динамический    │ В разработке    │
│ Язык            │ Solidity++      │ FunC/Tact       │ Solidity        │
│ Governance      │ DAO             │ Foundation      │ Гибридное       │
│ Killer app      │ DeFi/Enterprise │ Telegram        │ DeFi/NFT        │
└─────────────────┴─────────────────┴─────────────────┴─────────────────┘
```

## Ресурсы для изучения

- [Everscale Documentation](https://docs.everscale.network/)
- [Ever SDK](https://github.com/tonlabs/ever-sdk)
- [Solidity++ Compiler](https://github.com/tonlabs/TON-Solidity-Compiler)
- [Everscale Academy](https://everscale.network/developers)
- [FlatQube (DEX)](https://flatqube.io/)
- [Everscale Community](https://t.me/everscale)

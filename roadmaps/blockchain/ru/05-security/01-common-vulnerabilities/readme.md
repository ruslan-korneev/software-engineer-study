# Распространённые уязвимости смарт-контрактов

Безопасность смарт-контрактов — критически важный аспект разработки в блокчейне. В отличие от традиционного программного обеспечения, смарт-контракты после деплоя становятся неизменяемыми, а ошибки могут привести к потере миллионов долларов. История блокчейна знает множество громких взломов, связанных с уязвимостями в коде контрактов.

## Почему безопасность так важна?

1. **Неизменяемость**: После развёртывания контракт нельзя изменить (без использования прокси-паттернов)
2. **Публичность кода**: Весь код и состояние контракта доступны для анализа злоумышленниками
3. **Финансовые риски**: Смарт-контракты часто управляют значительными средствами
4. **Необратимость транзакций**: Украденные средства практически невозможно вернуть

## Основные категории уязвимостей

### 1. Reentrancy (Повторный вход)

Одна из самых известных и опасных уязвимостей. Позволяет злоумышленнику повторно вызывать функцию контракта до завершения первоначального вызова, что может привести к многократному снятию средств.

**Известный случай**: Взлом The DAO в 2016 году — похищено ~$60 млн ETH.

[Подробнее о Reentrancy](./01-reentrancy/readme.md)

### 2. Overflow/Underflow (Переполнение)

Арифметические уязвимости, связанные с переполнением или недополнением целочисленных переменных. В Solidity версий до 0.8.0 эти ошибки не вызывали исключений, что позволяло манипулировать балансами и обходить проверки.

**Известный случай**: Взлом BeautyChain (BEC) в 2018 году — создание триллионов токенов из воздуха.

[Подробнее о Overflow/Underflow](./02-overflow-underflow/readme.md)

### 3. Access Control (Контроль доступа)

Уязвимости, связанные с неправильной настройкой прав доступа к критическим функциям контракта. Отсутствие или некорректная реализация проверок авторизации может позволить любому пользователю выполнять привилегированные операции.

**Известный случай**: Взлом Parity Wallet в 2017 году — заморожено ~$150 млн ETH.

[Подробнее о Access Control](./03-access-control/readme.md)

## Другие распространённые уязвимости

| Уязвимость | Описание | Уровень риска |
|------------|----------|---------------|
| Front-running | Манипуляция порядком транзакций майнерами/валидаторами | Высокий |
| Flash Loan Attacks | Использование мгновенных займов для манипуляций | Критический |
| Oracle Manipulation | Манипуляция внешними источниками данных | Высокий |
| Denial of Service | Блокировка работы контракта | Средний |
| Timestamp Dependence | Зависимость от времени блока | Средний |
| Gas Griefing | Атаки с использованием газа | Низкий |

## Инструменты для аудита безопасности

### Статический анализ
- **Slither** — популярный статический анализатор от Trail of Bits
- **Mythril** — инструмент для символьного анализа
- **Securify** — автоматический анализатор от ETH Zurich

### Динамический анализ
- **Echidna** — фаззер для смарт-контрактов
- **Manticore** — символьное выполнение

### Формальная верификация
- **Certora** — формальная верификация
- **KEVM** — семантика EVM в K Framework

## Best Practices

1. **Используйте проверенные библиотеки**
   - OpenZeppelin Contracts
   - Solmate

2. **Следуйте паттернам безопасности**
   - Checks-Effects-Interactions (CEI)
   - Pull over Push для переводов
   - Emergency Stop (Circuit Breaker)

3. **Проводите аудиты**
   - Внутренний код-ревью
   - Внешний аудит от профессиональных компаний
   - Bug Bounty программы

4. **Тестируйте тщательно**
   - Unit-тесты с высоким покрытием
   - Integration-тесты
   - Fuzz-тестирование
   - Тесты на форках mainnet

5. **Используйте современные версии Solidity**
   - Solidity 0.8+ имеет встроенную защиту от overflow
   - Регулярно обновляйте зависимости

## Ресурсы для изучения

- [Smart Contract Weakness Classification (SWC)](https://swcregistry.io/)
- [Consensys Smart Contract Best Practices](https://consensys.github.io/smart-contract-best-practices/)
- [OpenZeppelin Security](https://www.openzeppelin.com/security-audits)
- [Damn Vulnerable DeFi](https://www.damnvulnerabledefi.xyz/) — практические задачи
- [Ethernaut](https://ethernaut.openzeppelin.com/) — CTF для изучения безопасности

## Заключение

Изучение уязвимостей смарт-контрактов — обязательный этап для любого блокчейн-разработчика. Понимание того, как работают атаки, позволяет писать более безопасный код и защищать средства пользователей. В следующих разделах мы детально разберём каждую из основных уязвимостей.

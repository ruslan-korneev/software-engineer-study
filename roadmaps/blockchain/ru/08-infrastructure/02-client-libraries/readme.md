# Клиентские библиотеки

## Обзор

Клиентские библиотеки (Client Libraries) — это JavaScript/TypeScript инструменты для взаимодействия с Ethereum и EVM-совместимыми блокчейнами. Они предоставляют удобный API для подключения к сети, чтения данных, отправки транзакций и работы со смарт-контрактами.

## Зачем нужны клиентские библиотеки?

Без клиентских библиотек разработчикам пришлось бы:
- Вручную формировать JSON-RPC запросы
- Самостоятельно реализовывать подпись транзакций
- Кодировать и декодировать ABI данные
- Управлять соединениями с нодами
- Обрабатывать различные форматы данных

Клиентские библиотеки абстрагируют эту сложность и предоставляют простой интерфейс для типичных операций.

## Основные функции

### 1. Подключение к сети
- HTTP/WebSocket провайдеры
- Поддержка браузерных кошельков (MetaMask)
- Fallback и резервирование провайдеров

### 2. Чтение данных
- Балансы аккаунтов
- Информация о блоках и транзакциях
- Вызов view/pure функций контрактов
- Получение логов и событий

### 3. Отправка транзакций
- Простые переводы ETH
- Вызов функций смарт-контрактов
- Поддержка EIP-1559 (динамические комиссии)
- Оценка газа

### 4. Управление ключами
- Создание кошельков
- Подпись транзакций и сообщений
- Поддержка HD кошельков
- Интеграция с аппаратными кошельками

### 5. Работа с контрактами
- ABI кодирование/декодирование
- Типизированный интерфейс контрактов
- Подписка на события

## Сравнение библиотек

| Характеристика | ethers.js | web3.js | viem |
|---------------|-----------|---------|------|
| **Размер** | ~120 КБ | ~500 КБ | ~35 КБ |
| **TypeScript** | Отлично | Хорошо | Отлично |
| **Зрелость** | 2016+ | 2015+ | 2023+ |
| **Документация** | Отличная | Хорошая | Отличная |
| **Сообщество** | Большое | Очень большое | Растущее |
| **Модульность** | Высокая | Средняя | Очень высокая |
| **Tree-shaking** | Да | Ограничено | Полный |
| **Multicall** | Нет | Нет | Встроен |
| **Производительность** | Хорошая | Средняя | Отличная |

## Когда использовать какую библиотеку?

### ethers.js
- Баланс между размером и функциональностью
- Отличная документация для обучения
- Подходит для большинства проектов
- Human-readable ABI

### web3.js
- Официальная библиотека Ethereum Foundation
- Много legacy кода использует её
- Система плагинов
- Максимальная совместимость

### viem
- Новые проекты с фокусом на производительность
- TypeScript-first разработка
- Минимальный размер бандла
- Интеграция с wagmi для React

## Типичный рабочий процесс

```javascript
// 1. Подключение к сети
const provider = createProvider("https://mainnet.infura.io/v3/KEY");

// 2. Чтение данных
const balance = await provider.getBalance(address);
const blockNumber = await provider.getBlockNumber();

// 3. Работа с контрактом
const contract = createContract(address, abi, provider);
const tokenName = await contract.name();

// 4. Отправка транзакции (требует signer)
const signer = createSigner(privateKey, provider);
const tx = await contract.connect(signer).transfer(to, amount);
await tx.wait();
```

## Важные концепции

### Provider vs Signer
- **Provider** — только чтение данных из блокчейна
- **Signer** — может подписывать транзакции (имеет доступ к приватному ключу)

### ABI (Application Binary Interface)
Описание интерфейса смарт-контракта:
- Имена функций и их параметры
- Типы возвращаемых значений
- События (events)
- Ошибки (errors)

### Gas и комиссии
- **Gas Limit** — максимум газа для транзакции
- **Gas Price** — цена за единицу газа (legacy)
- **Max Fee Per Gas** — максимальная цена (EIP-1559)
- **Max Priority Fee** — чаевые майнерам (EIP-1559)

## Безопасность

### Приватные ключи
- Никогда не хардкодьте в коде
- Используйте переменные окружения
- Для фронтенда — только браузерные кошельки

### Проверка адресов
- Всегда валидируйте входные адреса
- Используйте checksum адреса

### Симуляция транзакций
- Симулируйте перед отправкой
- Проверяйте газ и баланс

## Темы раздела

- [x] [ethers.js](./01-ethersjs/readme.md) — компактная и популярная библиотека
- [x] [web3.js](./02-web3js/readme.md) — официальная библиотека Ethereum
- [x] [viem](./03-viem/readme.md) — современная TypeScript-библиотека

## Дополнительные ресурсы

### Документация
- [ethers.js docs](https://docs.ethers.org/)
- [web3.js docs](https://docs.web3js.org/)
- [viem docs](https://viem.sh/)

### Инструменты
- [Infura](https://infura.io/) — RPC провайдер
- [Alchemy](https://www.alchemy.com/) — RPC провайдер + API
- [Chainlist](https://chainlist.org/) — список RPC эндпоинтов

### Обучение
- [Ethereum Developer Resources](https://ethereum.org/developers)
- [wagmi docs](https://wagmi.sh/) — React хуки для Ethereum
